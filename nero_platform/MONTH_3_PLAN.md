# –ú–ï–°–Ø–¶ 3: –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò
## Neiro Platform - Reports, Analytics, Notifications

**–ü–µ—Ä–∏–æ–¥:** –ú–µ—Å—è—Ü 3
**–°—Ç–∞—Ç—É—Å:** Planning
**–í–µ—Ä—Å–∏—è:** 2.4
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-21
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-22 (Notifications Split + Compliance)

---

## üìä EXECUTIVE SUMMARY

### –¶–µ–ª–∏ –ú–µ—Å—è—Ü–∞ 3
–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è: **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ ‚Üí –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí –û—Ç—á–µ—Ç ‚Üí –û—Ç–∑—ã–≤ ‚Üí –ü—Ä–æ–≥—Ä–µ—Å—Å**

### –ö–ª—é—á–µ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (OKRs)
1. **–†–æ–¥–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç—á–µ—Ç—ã —Å –º–µ–¥–∏–∞** (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ) - 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
2. **–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –≤–∏–¥—è—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É** –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É –¥–µ—Ç–µ–π —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö (email + in-app)
4. **100% E2E test coverage** - –≤—Å–µ 53+ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞
- ‚úÖ 90%+ –∑–∞–¥–∞–Ω–∏–π –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–æ–≤—Ä–µ–º—è (–±–ª–∞–≥–æ–¥–∞—Ä—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º)
- ‚úÖ 80%+ –æ—Ç—á–µ—Ç–æ–≤ —Å–æ–¥–µ—Ä–∂–∞—Ç –º–µ–¥–∏–∞ (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞)
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –æ—Ç—á–µ—Ç—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
- ‚úÖ API latency < 200ms (p95)

### –ù–æ–≤—ã–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
1. **Reports Service** (–ø–æ—Ä—Ç 4009) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞–º–∏ –∏ –º–µ–¥–∏–∞
2. **Analytics Service** (–ø–æ—Ä—Ç 4010) - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
3. **Notifications Service** (–ø–æ—Ä—Ç 4011) - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (email + in-app)
4. **Communications Service** (–ø–æ—Ä—Ç 4012) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —É—Å–ø–µ–µ–º

---

## üóìÔ∏è –ö–ê–õ–ï–ù–î–ê–†–ù–´–ô –ü–õ–ê–ù

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    –ù–µ–¥–µ–ª—è   ‚îÇ                  –§–æ–∫—É—Å                   ‚îÇ   –°—Ç–∞—Ç—É—Å    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Week 0    ‚îÇ Infrastructure Pre-work (DevOps)         ‚îÇ  üîß SETUP   ‚îÇ
‚îÇ   Week 1    ‚îÇ Reports Service + File Uploads           ‚îÇ  üìù TODO    ‚îÇ
‚îÇ   Week 2    ‚îÇ Analytics Service + Progress Dashboards  ‚îÇ  üìù TODO    ‚îÇ
‚îÇ   Week 3    ‚îÇ Notifications Service + Email Delivery   ‚îÇ  üìù TODO    ‚îÇ
‚îÇ   Week 4    ‚îÇ Testing, Documentation, Polish           ‚îÇ  üìù TODO    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π timeline:** 5 –Ω–µ–¥–µ–ª—å (Week 0 + 4 –Ω–µ–¥–µ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω Week 0 –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –±–ª–æ–∫–µ—Ä–æ–≤

---

## üîó –î–ò–ê–ì–†–ê–ú–ú–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô –ó–ê–î–ê–ß

### Week 0 ‚Üí Week 1 ‚Üí Week 2 ‚Üí Week 3 Dependencies

```mermaid
graph TB
    subgraph Week0["üîß WEEK 0: Infrastructure"]
        W0_1["0.1 MinIO Setup"]
        W0_2["0.2 Redis Setup"]
        W0_3["0.3 SendGrid Setup"]
        W0_4["0.4 Environment Variables"]
        W0_5["0.5 Schema Review"]
        W0_6["0.6 Database Migrations"]
    end

    subgraph Week1["üìù WEEK 1: Reports Service"]
        W1_1["1.1 Reports Service"]
        W1_2["1.2 Media Upload"]
        W1_3["1.3 Report Review"]
        W1_4["1.4 EventOutbox"]
        W1_5["1.5 Frontend"]
    end

    subgraph Week2["üìä WEEK 2: Analytics Service"]
        W2_1["2.1 Analytics Service"]
        W2_2["2.2 Progress API"]
        W2_3["2.3 Caching"]
        W2_4["2.4 Frontend Dashboards"]
    end

    subgraph Week3["üìß WEEK 3: Notifications"]
        W3_1["3.1 Notifications Service"]
        W3_2["3.2 User Notifications UI"]
        W3_3["3.3 Email Templates"]
        W3_4["3.4 SendGrid Integration"]
        W3_5["3.5 Frontend UI"]
    end

    %% Week 0 dependencies
    W0_1 --> W1_2
    W0_2 --> W2_3
    W0_3 --> W3_4
    W0_4 --> W1_1
    W0_4 --> W2_1
    W0_4 --> W3_1
    W0_5 --> W0_6
    W0_6 --> W3_2

    %% Week 1 internal
    W1_1 --> W1_2
    W1_2 --> W1_3
    W1_3 --> W1_4
    W1_4 --> W1_5

    %% Week 1 ‚Üí Week 2
    W1_4 --> W2_1
    W1_1 --> W2_2

    %% Week 2 internal
    W2_1 --> W2_2
    W2_2 --> W2_3
    W2_3 --> W2_4

    %% Week 2 ‚Üí Week 3
    W2_1 --> W3_1

    %% Week 3 internal
    W3_1 --> W3_2
    W3_1 --> W3_3
    W3_3 --> W3_4
    W3_4 --> W3_5
    W3_2 --> W3_5

    %% Critical path
    W1_4 -.->|EventOutbox Events| W3_1
    W0_6 -.->|UserNotification model| W3_2

    style W0_1 fill:#ff6b6b
    style W0_2 fill:#ff6b6b
    style W0_3 fill:#feca57
    style W0_6 fill:#ff6b6b
    style W1_4 fill:#4ecdc4
    style W3_2 fill:#95afc0
```

### –õ–µ–≥–µ–Ω–¥–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–µ—Ä—ã (P0):**
- **0.1 MinIO** ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç 1.2 Media Upload
- **0.2 Redis** ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç 2.3 Caching
- **0.6 Migrations** ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç 3.2 User Notifications UI

üü° **–í–∞–∂–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (P1):**
- **0.3 SendGrid** ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç 3.4 Email Integration (–Ω–æ –µ—Å—Ç—å fallback SMTP)
- **1.4 EventOutbox** ‚Üí –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è 3.1 Notifications consumers

üîµ **–ú—è–≥–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- Analytics Service –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å Reports
- Frontend —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–æ–≥—É—Ç —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å backend

### –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç

**Week 1:**
- Task 1.1 (Reports API) + Task 1.2 (Media Upload) ‚Üí –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- Task 1.5 (Frontend) –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å—Å—è –ø–æ—Å–ª–µ 1.1 (—Å –º–æ–∫–∞–º–∏)

**Week 2:**
- Task 2.1 (Analytics API) + Task 2.2 (Progress endpoints) ‚Üí –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- Task 2.4 (Frontend) –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å 2.3 (Caching)

**Week 3:**
- Task 3.1 (Notifications backend) + Task 3.2 (User Notifications) ‚Üí –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- Task 3.3 (Email templates) + Task 3.5 (Frontend) ‚Üí –º–æ–≥—É—Ç –∏–¥—Ç–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

---

# üîß WEEK 0: INFRASTRUCTURE PRE-WORK (DEVOPS)

**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞—Ä–∞–Ω–µ–µ, —á—Ç–æ–±—ã Week 1-3 –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º MinIO, SendGrid, Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

**–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:** 8 —á–∞—Å–æ–≤ (DevOps/–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ—Ç)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–±–ª–æ–∫–µ—Ä –¥–ª—è Week 1, 2, 3)
**–ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:** –î–æ –Ω–∞—á–∞–ª–∞ Week 1

---

## 0.1 MinIO Storage Configuration

### –ó–∞–¥–∞—á–∞ 0.1.1: –°–æ–∑–¥–∞–Ω–∏–µ buckets –∏ access policies
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** Week 1 Task 1.1.3 (Media Upload)

#### Acceptance Criteria
- [ ] MinIO bucket `neiro-reports` —Å–æ–∑–¥–∞–Ω
- [ ] MinIO bucket `neiro-reports-thumbnails` —Å–æ–∑–¥–∞–Ω (–¥–ª—è –ø—Ä–µ–≤—å—é)
- [ ] Access policy –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞: –ø—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –¥–ª—è thumbnails, –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –¥–ª—è reports
- [ ] MinIO Client (mc) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –°–æ–∑–¥–∞–Ω `.env` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏: `MINIO_ENDPOINT`, `MINIO_ACCESS_KEY`, `MINIO_SECRET_KEY`, `MINIO_BUCKET_REPORTS`
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: `docker exec neiro_minio mc ls minio/neiro-reports` —Ä–∞–±–æ—Ç–∞–µ—Ç

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```bash
# 1. –°–æ–∑–¥–∞—Ç—å buckets
docker exec neiro_minio mc mb minio/neiro-reports
docker exec neiro_minio mc mb minio/neiro-reports-thumbnails

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –¥–æ—Å—Ç—É–ø–∞
docker exec neiro_minio mc anonymous set download minio/neiro-reports-thumbnails
docker exec neiro_minio mc anonymous set none minio/neiro-reports

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞
docker exec neiro_minio mc ls minio/
```

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- MinIO —É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –ø–æ—Ä—Ç—É 9000/9001 (—Å–º. docker-compose.yml)
- –ö–æ–Ω—Å–æ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞: http://localhost:9001
- Access Key: `minioadmin` / Secret: `minioadmin123` (–¥–ª—è dev –æ–∫—Ä—É–∂–µ–Ω–∏—è)

---

## 0.2 Redis Caching Strategy

### –ó–∞–¥–∞—á–∞ 0.2.1: Redis configuration –¥–ª—è Analytics cache
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å
**–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** Week 2 Task 2.1.3 (Progress Aggregation)

#### Acceptance Criteria
- [ ] Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å TTL –ø–æ–ª–∏—Ç–∏–∫–æ–π –¥–ª—è analytics (5 –º–∏–Ω—É—Ç)
- [ ] Redis namespace convention: `analytics:child:{childId}:progress`
- [ ] –°–æ–∑–¥–∞–Ω `.env` —Å `REDIS_HOST`, `REDIS_PORT`, `REDIS_PASSWORD`
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω cache invalidation strategy –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Redis —É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –ø–æ—Ä—Ç—É 6380 (–≤–Ω–µ—à–Ω–∏–π) / 6379 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤ docker network) (—Å–º. docker-compose.yml)
- –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `redis://redis:6379`
- –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å —Ö–æ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `redis://localhost:6380`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ioredis` –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- TTL –¥–ª—è –∫—ç—à–∞: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
- Invalidation: –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è

---

## 0.3 Email Delivery Setup (SendGrid)

### –ó–∞–¥–∞—á–∞ 0.3.1: SendGrid account –∏ API key
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** Week 3 Task 3.1.2 (Email Templates)

#### Acceptance Criteria
- [ ] SendGrid account —Å–æ–∑–¥–∞–Ω (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
- [ ] API Key —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å –ø—Ä–∞–≤–∞–º–∏ `Mail Send`
- [ ] Verified Sender Email –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `noreply@neiro.dev`)
- [ ] –°–æ–∑–¥–∞–Ω `.env` —Å `SENDGRID_API_KEY`, `SENDGRID_FROM_EMAIL`, `SENDGRID_FROM_NAME`
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ SendGrid API
- [ ] Fallback: –µ—Å–ª–∏ SendGrid –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Nodemailer + SMTP (Gmail –¥–ª—è dev)

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
```bash
# –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ curl
curl --request POST \
  --url https://api.sendgrid.com/v3/mail/send \
  --header "Authorization: Bearer $SENDGRID_API_KEY" \
  --header 'Content-Type: application/json' \
  --data '{"personalizations":[{"to":[{"email":"admin@neiro.dev"}]}],"from":{"email":"noreply@neiro.dev"},"subject":"Test","content":[{"type":"text/plain","value":"Hello"}]}'
```

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–µ—Å–ª–∏ SendGrid –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Nodemailer + Gmail SMTP**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å App Password –¥–ª—è Gmail –∞–∫–∫–∞—É–Ω—Ç–∞
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `SMTP_HOST=smtp.gmail.com`, `SMTP_PORT=587`, `SMTP_USER`, `SMTP_PASS`

---

## 0.4 Environment Variables & Secrets

### –ó–∞–¥–∞—á–∞ 0.4.1: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π `.env.example` –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å

#### Acceptance Criteria
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω `.env.example` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –¥–ª—è Reports, Analytics, Notifications
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π `.env` —Ñ–∞–π–ª –æ–±–Ω–æ–≤–ª–µ–Ω (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git)
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

#### –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `.env`
```bash
# ============================================================
# MinIO Storage (Week 1 - Reports)
# ============================================================
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin123
MINIO_BUCKET_REPORTS=neiro-reports
MINIO_USE_SSL=false

# ============================================================
# Redis Cache (Week 2 - Analytics)
# ============================================================
# –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å —Ö–æ—Å—Ç–∞
REDIS_HOST=localhost
REDIS_PORT=6380
# –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: redis://redis:6379
REDIS_PASSWORD=
REDIS_ANALYTICS_TTL=300

# ============================================================
# Email Delivery (Week 3 - Notifications)
# ============================================================
SENDGRID_API_KEY=SG.xxxxxxxxxxxxx
SENDGRID_FROM_EMAIL=noreply@neiro.dev
SENDGRID_FROM_NAME="Neiro Platform"
# Fallback SMTP (–µ—Å–ª–∏ SendGrid –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
```

---

## 0.5 Database Schema Extensions

### –ó–∞–¥–∞—á–∞ 0.5.1: –û–±–∑–æ—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π –ë–î –¥–ª—è Month 3
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è)
**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å

#### Acceptance Criteria
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏: `Report`, `Notification`, `MediaAsset`
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è JSON –ø–æ–ª–µ–π
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è `NotificationPreference`

### –ó–∞–¥–∞—á–∞ 0.6: Database Migrations –¥–ª—è Month 3
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–í–ª–∞–¥–µ–ª–µ—Ü:** Database Team
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**Deadline:** –î–æ –Ω–∞—á–∞–ª–∞ Week 3
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (2025-01-25)

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Dual-Layer Notifications System

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ç—Ä—ë—Ö—Å–ª–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
1. **Delivery Layer** (`notifications`) - –æ—á–µ—Ä–µ–¥—å –¥–æ—Å—Ç–∞–≤–∫–∏ email/SMS/push
2. **UI Layer** (`user_notifications`) - in-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
3. **Preferences Layer** (`notification_preferences`) - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ú–∏–≥—Ä–∞—Ü–∏–∏

**Migration 0008_update_notification_model.sql:**
–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É `notifications` –¥–ª—è Hybrid Approach:
- –î–æ–±–∞–≤–ª—è–µ—Ç `recipient_id UUID` (FK –Ω–∞ users) –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–æ–±–∞–≤–ª—è–µ—Ç `template VARCHAR(100)` –¥–ª—è —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª—è–µ—Ç `last_error TEXT` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ failed notifications
- –ú–∏–≥—Ä–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `payload` –≤ —è–≤–Ω—ã–µ –ø–æ–ª—è
- –°–æ–∑–¥–∞—ë—Ç composite indexes –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```sql
-- –°–º. packages/database/migrations/0008_update_notification_model.sql
-- Key features:
-- - ALTER TABLE notifications ADD COLUMN recipient_id, template, last_error
-- - UPDATE –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
-- - CREATE INDEX idx_notifications_recipient_status
-- - CREATE INDEX idx_notifications_status_scheduled
```

**Migration 0009_create_user_notifications.sql:**
–°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É UI layer –¥–ª—è in-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
- –¢–∞–±–ª–∏—Ü–∞ `user_notifications` —Å userId, type, title, body, link, status, readAt
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π trigger –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `read_at` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ status –Ω–∞ 'read'
- View `user_notification_counts` –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- –ü–æ–ª–∏–º–æ—Ä—Ñ–Ω–∞—è —Å–≤—è–∑—å —Å `notifications` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π FK)

```sql
-- –°–º. packages/database/migrations/0009_create_user_notifications.sql
-- Key features:
-- - CREATE TABLE user_notifications —Å UI-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
-- - CREATE FUNCTION set_user_notification_read_at() –¥–ª—è auto read_at
-- - CREATE VIEW user_notification_counts –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–¥—Å—á—ë—Ç–∞
-- - CREATE INDEX –¥–ª—è (user_id, status, created_at) queries
```

**Migration 0010_create_notification_preferences.sql:**
–°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
- –¢–∞–±–ª–∏—Ü–∞ `notification_preferences` —Å JSONB –¥–ª—è –≥–∏–±–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –§—É–Ω–∫—Ü–∏—è `get_default_notification_preferences()` –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π trigger –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è preferences –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –§—É–Ω–∫—Ü–∏—è `is_notification_allowed()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –∏ quiet hours

```sql
-- –°–º. packages/database/migrations/0010_create_notification_preferences.sql
-- Key features:
-- - CREATE TABLE notification_preferences —Å preferences JSONB
-- - CREATE FUNCTION create_default_notification_preferences()
-- - CREATE TRIGGER –Ω–∞ users –¥–ª—è auto-—Å–æ–∑–¥–∞–Ω–∏—è preferences
-- - CREATE FUNCTION is_notification_allowed(user_id, type, channel, time)
```

#### Prisma Schema Updates

**‚úÖ –í–´–ü–û–õ–ù–ï–ù–û:** schema.prisma –æ–±–Ω–æ–≤–ª—ë–Ω (lines 694-763)

–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç—Ä–∏ –º–æ–¥–µ–ª–∏ —Å dual-layer –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:

```prisma
// Delivery Layer
model Notification {
  id          String    @id @default(uuid()) @db.Uuid
  recipientId String    @map("recipient_id") @db.Uuid  // NEW: Explicit field
  channel     String    @db.VarChar(50)
  template    String?   @db.VarChar(100)              // NEW: Explicit field
  payload     Json      @db.JsonB
  status      String    @default("pending") @db.VarChar(20)
  attempts    Int       @default(0)
  lastError   String?   @map("last_error") @db.Text  // NEW: Explicit field
  scheduledAt DateTime  @map("scheduled_at") @db.Timestamptz(6)
  sentAt      DateTime? @map("sent_at") @db.Timestamptz(6)
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  recipient         User               @relation("NotificationRecipient", fields: [recipientId], references: [id], onDelete: Cascade)
  userNotifications UserNotification[]

  @@index([recipientId, status])
  @@index([status, scheduledAt])
  @@map("notifications")
}

// UI Layer
model UserNotification {
  id             String    @id @default(uuid()) @db.Uuid
  userId         String    @map("user_id") @db.Uuid
  notificationId String?   @map("notification_id") @db.Uuid
  type           String    @db.VarChar(50)
  title          String    @db.VarChar(150)
  body           String    @db.Text
  link           String?   @db.VarChar(255)
  status         String    @default("unread") @db.VarChar(20)
  readAt         DateTime? @map("read_at") @db.Timestamptz(6)
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  user         User          @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)
  notification Notification? @relation(fields: [notificationId], references: [id], onDelete: SetNull)

  @@index([userId, status, createdAt])
  @@index([userId, createdAt])
  @@map("user_notifications")
}

// Preferences Layer
model NotificationPreference {
  id          String   @id @default(uuid()) @db.Uuid
  userId      String   @unique @map("user_id") @db.Uuid
  preferences Json     @default("{}") @db.JsonB
  quietHours  Json?    @map("quiet_hours") @db.JsonB
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  user User @relation("NotificationPreferences", fields: [userId], references: [id], onDelete: Cascade)

  @@map("notification_preferences")
}
```

**User model** —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—ë–Ω —Å relations:
```prisma
sentNotifications     Notification[]           @relation("NotificationRecipient")
userNotifications     UserNotification[]       @relation("UserNotifications")
notificationPrefs     NotificationPreference?  @relation("NotificationPreferences")
```

#### Acceptance Criteria
- [x] DDL scripts —Å–æ–∑–¥–∞–Ω—ã –≤ `packages/database/migrations/` (0008, 0009, 0010)
- [x] Rollback scripts —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- [x] schema.prisma –æ–±–Ω–æ–≤–ª—ë–Ω —Å —Ç—Ä–µ–º—è –º–æ–¥–µ–ª—è–º–∏ + User relations
- [x] Prisma schema –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (2025-11-25)
- [x] `prisma generate` —Å–æ–∑–¥–∞–ª —Ç–∏–ø—ã –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
- [x] Seed –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã (4 notifications, 5 user_notifications, 15 preferences via trigger)
- [x] Foreign keys –≤–∞–ª–∏–¥–Ω—ã (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ dev DB)
- [x] Indexes —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã —Å EXPLAIN ANALYZE (0.069-0.098ms execution time)

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# Week 0: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏
cd /Users/andreyafanasyev/Projects/Platform/nero_platform/packages/database

# 1. ‚úÖ DDL scripts –£–ñ–ï –°–û–ó–î–ê–ù–´:
# - migrations/0008_update_notification_model.sql (+ rollback)
# - migrations/0009_create_user_notifications.sql (+ rollback)
# - migrations/0010_create_notification_preferences.sql (+ rollback)

# 2. ‚úÖ schema.prisma –£–ñ–ï –û–ë–ù–û–í–õ–Å–ù (lines 694-763)

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –ë–î
docker exec -i neiro_postgres psql -U neiro_user -d neiro_platform < migrations/0008_update_notification_model.sql
docker exec -i neiro_postgres psql -U neiro_user -d neiro_platform < migrations/0009_create_user_notifications.sql
docker exec -i neiro_postgres psql -U neiro_user -d neiro_platform < migrations/0010_create_notification_preferences.sql

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã
docker exec neiro_postgres psql -U neiro_user -d neiro_platform -c "\d notifications"
docker exec neiro_postgres psql -U neiro_user -d neiro_platform -c "\dt user_notifications"
docker exec neiro_postgres psql -U neiro_user -d neiro_platform -c "\dt notification_preferences"

# 5. –í–∞–ª–∏–¥–∞—Ü–∏—è Prisma schema
DATABASE_URL="postgres://neiro_user:neiro_password_dev@127.0.0.1:5437/neiro_platform" \
  pnpm exec prisma validate

# 6. Generate Prisma Client —Å –Ω–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏
DATABASE_URL="postgres://neiro_user:neiro_password_dev@127.0.0.1:5437/neiro_platform" \
  pnpm exec prisma generate

# 7. –°–æ–∑–¥–∞—Ç—å seed –¥–∞–Ω–Ω—ã–µ (—Å–º. Task 0.6.1 –Ω–∏–∂–µ)
DATABASE_URL="postgres://neiro_user:neiro_password_dev@127.0.0.1:5437/neiro_platform" \
  pnpm --filter @neiro/database db:seed:notifications
```

#### Rollback Scripts

**‚úÖ –°–û–ó–î–ê–ù–´:** packages/database/migrations/

- `0010_rollback.sql` - –£–¥–∞–ª—è–µ—Ç notification_preferences, triggers, functions
- `0009_rollback.sql` - –£–¥–∞–ª—è–µ—Ç user_notifications, view, triggers
- `0008_rollback.sql` - –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ notifications (—É–¥–∞–ª—è–µ—Ç recipient_id, template, last_error)

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ rollback:
```bash
# –í –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ!
docker exec -i neiro_postgres psql -U neiro_user -d neiro_platform < migrations/0010_rollback.sql
docker exec -i neiro_postgres psql -U neiro_user -d neiro_platform < migrations/0009_rollback.sql
docker exec -i neiro_postgres psql -U neiro_user -d neiro_platform < migrations/0008_rollback.sql
```

#### ‚úÖ –°—Ç–∞—Ç—É—Å –º–æ–¥–µ–ª–µ–π

**Notification:** ‚ö†Ô∏è –°–£–©–ï–°–¢–í–£–ï–¢, –Ω–æ **—Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** (Migration 0008)
- ‚ùå –ù–ï–¢ `recipient_id` ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ 0008
- ‚ùå –ù–ï–¢ `template` ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ 0008
- ‚ùå –ù–ï–¢ `last_error` ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ 0008
- ‚úÖ Hybrid Approach: explicit fields + JSONB payload

**UserNotification:** ‚ùå –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢ ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ Migration 0009

**NotificationPreference:** ‚ùå –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢ ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ Migration 0010

**Report, MediaAsset:** ‚úÖ –£–ñ–ï –°–£–©–ï–°–¢–í–£–Æ–¢ - –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è

#### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –º–æ–¥–µ–ª—å Report (schema.prisma:501-525)

```prisma
model Report {
  id              String    @id @default(uuid()) @db.Uuid
  assignmentId    String    @map("assignment_id") @db.Uuid
  parentId        String    @map("parent_id") @db.Uuid
  reviewedBy      String?   @map("reviewed_by") @db.Uuid
  submittedAt     DateTime  @default(now()) @map("submitted_at") @db.Timestamptz(6)
  status          String    @db.VarChar(20)  // completed, partial, failed
  durationMinutes Int       @map("duration_minutes")
  childMood       String    @map("child_mood") @db.VarChar(20)  // good, neutral, difficult
  feedbackText    String    @map("feedback_text") @db.Text
  media           Json?     @db.JsonB  // ‚úÖ –ú–∞—Å—Å–∏–≤ –º–µ–¥–∏–∞ –≤ JSON!
  autoScore       Decimal?  @map("auto_score") @db.Decimal(5, 2)
  reviewedAt      DateTime? @map("reviewed_at") @db.Timestamptz(6)
  reviewStatus    String    @default("not_reviewed") @map("review_status") @db.VarChar(50)

  assignment Assignment    @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  parent     User          @relation("ParentReports", fields: [parentId], references: [id])
  reviews    ReportReview[]

  @@map("reports")
}
```

**–§–æ—Ä–º–∞—Ç Report.media (JSON):**
```json
[
  {
    "url": "https://minio/reports/uuid-123/photo1.jpg",
    "type": "photo",
    "thumbnailUrl": "https://minio/reports/uuid-123/thumb1.jpg",
    "fileSize": 2048576,
    "mimeType": "image/jpeg"
  }
]
```

#### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –º–æ–¥–µ–ª—å MediaAsset (schema.prisma:678-689)

```prisma
model MediaAsset {
  id        String    @id @default(uuid()) @db.Uuid
  ownerType String    @map("owner_type") @db.VarChar(50)  // "report", "exercise", etc.
  ownerId   String    @map("owner_id") @db.Uuid
  mediaType String?   @map("media_type") @db.VarChar(50)
  path      String    @db.VarChar(500)  // –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤ MinIO
  checksum  String?   @db.VarChar(64)
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  expiresAt DateTime? @map("expires_at") @db.Timestamptz(6)

  @@map("media_assets")
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤:**
```typescript
await prisma.mediaAsset.create({
  data: {
    ownerType: 'report',
    ownerId: reportId,
    mediaType: 'photo',
    path: 'reports/uuid-123/photo1.jpg'
  }
})
```

#### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –º–æ–¥–µ–ª—å Notification (schema.prisma:696-708) - DELIVERY LAYER

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –°–æ–≥–ª–∞—Å–Ω–æ NOTIFICATIONS_SPLIT_PROPOSAL.md, –º–æ–¥–µ–ª—å `Notification` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏** (email/SMS/push), –∞ –ù–ï –¥–ª—è in-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π UI.

```prisma
model Notification {
  id          String    @id @default(uuid()) @db.Uuid
  recipientId String    @map("recipient_id") @db.Uuid  // –ö–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
  channel     String    @db.VarChar(50)  // email, sms, push, telegram
  template    String    @db.VarChar(100)  // assignment_reminder, report_reviewed
  payload     Json      @db.JsonB  // –î–∞–Ω–Ω—ã–µ –¥–ª—è —à–∞–±–ª–æ–Ω–∞
  status      String    @default("pending") @db.VarChar(20)  // pending, sent, failed, bounced
  attempts    Int       @default(0)
  scheduledAt DateTime  @map("scheduled_at") @db.Timestamptz(6)
  sentAt      DateTime? @map("sent_at") @db.Timestamptz(6)
  lastError   String?   @map("last_error") @db.Text  // –¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—à–∏–±–∫–∏
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  @@map("notifications")
}
```

**–§–æ—Ä–º–∞—Ç Notification.payload (JSON):**
```json
{
  "assignmentId": "uuid-456",
  "assignmentTitle": "–ê—Ä—Ç–∏–∫—É–ª—è—Ü–∏–æ–Ω–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞",
  "scheduledTime": "15:00",
  "parentName": "–ò–≤–∞–Ω"
}
```

**‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è `recipientId`, `template`, `lastError` –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É `notifications`.

#### –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å UserNotification (—Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è) - UI LAYER

**–≠—Ç–∞ –º–æ–¥–µ–ª—å –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢** - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Week 3 –¥–ª—è **in-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π UI**.

```prisma
model UserNotification {
  id             String    @id @default(uuid()) @db.Uuid
  userId         String    @map("user_id") @db.Uuid
  notificationId String?   @map("notification_id") @db.Uuid  // –°–≤—è–∑—å —Å delivery notification
  type           String    @db.VarChar(50)  // assignment_reminder, report_reviewed, route_updated
  title          String    @db.VarChar(150)
  body           String    @db.Text
  link           String?   @db.VarChar(255)  // URL –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ
  status         String    @default("unread") @db.VarChar(20)  // unread, read, archived
  readAt         DateTime? @map("read_at") @db.Timestamptz(6)
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  notification   Notification? @relation(fields: [notificationId], references: [id], onDelete: SetNull)

  @@index([userId, status])
  @@index([userId, createdAt])
  @@map("user_notifications")
}
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏:**
```typescript
await prisma.userNotification.create({
  data: {
    userId: parentId,
    notificationId: emailNotificationId,  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - —Å–≤—è–∑—å —Å email
    type: 'assignment_reminder',
    title: '–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–¥–∞–Ω–∏–∏',
    body: '–ß–µ—Ä–µ–∑ 1 —á–∞—Å –Ω–∞—á–∞–ª–æ –∑–∞–Ω—è—Ç–∏—è "–ê—Ä—Ç–∏–∫—É–ª—è—Ü–∏–æ–Ω–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞"',
    link: '/dashboard/assignments/uuid-456',
    status: 'unread'
  }
})
```

#### –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å NotificationPreference (—Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è)

**–≠—Ç–∞ –º–æ–¥–µ–ª—å –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢** - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Week 3.

```prisma
model NotificationPreference {
  id                 String   @id @default(uuid()) @db.Uuid
  userId             String   @unique @map("user_id") @db.Uuid
  emailEnabled       Boolean  @default(true) @map("email_enabled")
  inAppEnabled       Boolean  @default(true) @map("in_app_enabled")
  assignmentReminders Boolean @default(true) @map("assignment_reminders")
  reportUpdates      Boolean  @default(true) @map("report_updates")
  routeChanges       Boolean  @default(true) @map("route_changes")
  updatedAt          DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notification_preferences")
}
```

#### Acceptance Criteria –¥–ª—è UserNotification Integration

**Database:**
- [ ] –¢–∞–±–ª–∏—Ü–∞ user_notifications —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∞
- [ ] –¢–∞–±–ª–∏—Ü–∞ notification_preferences —Å–æ–∑–¥–∞–Ω–∞
- [ ] Seed –¥–∞–Ω–Ω—ã–µ –¥–ª—è 3 —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] Foreign keys —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**EventOutbox Integration:**
- [ ] Consumer —Å–æ–∑–¥–∞—ë—Ç UserNotification –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ reports.report.submitted
- [ ] Consumer —Å–æ–∑–¥–∞—ë—Ç UserNotification –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ assignments.assignment.created
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ preferences –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º UserNotification
- [ ] Quiet hours —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è (no notifications during quiet period)

**API Endpoints:**
- [ ] GET /user-notifications/v1 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- [ ] GET /user-notifications/v1/:id –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª–∏
- [ ] PATCH /user-notifications/v1/:id/read –æ–±–Ω–æ–≤–ª—è–µ—Ç status –∏ readAt
- [ ] PATCH /user-notifications/v1/read-all —Ä–∞–±–æ—Ç–∞–µ—Ç (batch update)
- [ ] DELETE /user-notifications/v1/:id –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç (status ‚Üí archived)
- [ ] GET /notification-preferences/v1 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç preferences —Å defaults
- [ ] PATCH /notification-preferences/v1 –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç

**Tests:**
- [ ] Unit tests: NotificationService.createUserNotification()
- [ ] Integration test: EventOutbox ‚Üí UserNotification flow
- [ ] Integration test: Preferences filtering —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] E2E test N-1: "Parent –≤–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è assignment"
- [ ] E2E test N-2: "Specialist –∏–∑–º–µ–Ω—è–µ—Ç preferences, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç"
- [ ] E2E test N-3: "Mark all as read –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á—ë—Ç—á–∏–∫"

**Performance:**
- [ ] Query —Å userId + status –∏—Å–ø–æ–ª—å–∑—É–µ—Ç index
- [ ] EXPLAIN ANALYZE –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Index Scan (–Ω–µ Seq Scan)
- [ ] Batch update /read-all –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è <100ms –¥–ª—è 1000 notifications

**Cleanup:**
- [ ] Cron job –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç notifications —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
- [ ] Archived notifications —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 90 –¥–Ω–µ–π

---

## Week 0 Exit Criteria (Go/No-Go –¥–ª—è Week 1)

### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ (P0) - –±–ª–æ–∫–µ—Ä—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- [ ] MinIO buckets —Å–æ–∑–¥–∞–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- [ ] Redis —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] SendGrid API key –ø–æ–ª—É—á–µ–Ω –ò–õ–ò SMTP –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] `.env` —Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] Prisma schema preview —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω

### üìã –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (P1) - –Ω–µ –±–ª–æ–∫–µ—Ä—ã:
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ MinIO/Redis/SMTP —Å–æ–∑–¥–∞–Ω—ã

### üö® Red Flags (–ø—Ä–∏—á–∏–Ω—ã –¥–ª—è No-Go):
- ‚ùå MinIO –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ buckets –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
- ‚ùå SendGrid –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ò SMTP –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–±–ª–æ–∫–∏—Ä—É–µ—Ç Week 2 Analytics)

---

# üìÖ WEEK 1: REPORTS SERVICE + FILE UPLOADS

**–¶–µ–ª—å:** –†–æ–¥–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç—á–µ—Ç—ã —Å —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ, —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –∏—Ö –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç

**–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:** 40 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)

---

## 1.1 Backend: Reports Service Setup

### –ó–∞–¥–∞—á–∞ 1.1.1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Reports Service
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –Ω–µ—Ç

#### Acceptance Criteria
- [ ] –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞ `services/reports/`
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω TypeScript + tsconfig.json
- [ ] Dockerfile —Å–æ–∑–¥–∞–Ω (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º)
- [ ] package.json —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- [ ] Health check endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç: `GET /health`
- [ ] –°–µ—Ä–≤–∏—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ docker-compose.yml –Ω–∞ –ø–æ—Ä—Ç 4009

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
services/reports/
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ index.ts
    ‚îú‚îÄ‚îÄ app.ts
    ‚îî‚îÄ‚îÄ config/
        ‚îî‚îÄ‚îÄ index.ts
```

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Node.js 20 + TypeScript 5
- Express.js framework
- Prisma Client (shared database)
- Winston –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- Helmet –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

### –ó–∞–¥–∞—á–∞ 1.1.2: Reports API - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 8 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 1.1.1

#### API Endpoints

```typescript
POST   /reports/v1                      // –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç
GET    /reports/v1/:id                  // –ü–æ–ª—É—á–∏—Ç—å –æ—Ç—á–µ—Ç –ø–æ ID
GET    /reports/v1                      // –°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤ (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
PATCH  /reports/v1/:id                  // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç—á–µ—Ç
DELETE /reports/v1/:id                  // –£–¥–∞–ª–∏—Ç—å –æ—Ç—á–µ—Ç (soft delete)
```

#### Request/Response –ø—Ä–∏–º–µ—Ä—ã

**POST /reports/v1**
```json
{
  "assignmentId": "uuid",
  "durationMinutes": 25,
  "status": "completed",
  "childMood": "good",
  "feedbackText": "–û—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–∏–ª—Å—è —Å –∑–∞–¥–∞–Ω–∏–µ–º!",
  "media": [
    {
      "mediaId": "uuid",
      "type": "photo",
      "url": "https://storage.neiro.dev/...",
      "durationSeconds": null
    }
  ]
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ –ø–æ–ª—è–º:**
- `durationMinutes` (–Ω–µ `actualDurationMinutes`) - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `status`: `"completed" | "partial" | "failed"` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- `childMood`: `"good" | "neutral" | "difficult"` (–Ω–µ `happy/sad`)
- `feedbackText` (–Ω–µ `notes`) - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–æ–¥–∏—Ç–µ–ª—è, max 1024 —Å–∏–º–≤–æ–ª–∞
- `media` - –º–∞—Å—Å–∏–≤ —Å—Å—ã–ª–æ–∫ –Ω–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ `/media/v1/upload/presigned`
- `parentId` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ JWT token (–Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–µ)

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "assignmentId": "uuid",
    "parentId": "uuid",
    "reportDate": "2025-01-21",
    "durationMinutes": 25,
    "status": "completed",
    "childMood": "good",
    "feedbackText": "–û—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–∏–ª—Å—è —Å –∑–∞–¥–∞–Ω–∏–µ–º!",
    "media": [
      {
        "mediaId": "uuid",
        "type": "photo",
        "url": "https://storage.neiro.dev/...",
        "durationSeconds": null
      }
    ],
    "submittedAt": "2025-01-21T10:31:00Z",
    "reviewStatus": "not_reviewed",
    "reviewedBy": null,
    "reviewedAt": null,
    "reviewNotes": null,
    "autoScore": null
  }
}
```

#### Acceptance Criteria
- [ ] –í—Å–µ 5 endpoint'–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Zod schemas
- [ ] RBAC: —Ä–æ–¥–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –æ—Ç—á–µ—Ç—ã
- [ ] RBAC: —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤–∏–¥–∏—Ç –æ—Ç—á–µ—Ç—ã —Å–≤–æ–∏—Ö –¥–µ—Ç–µ–π
- [ ] –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞ Assignment.status –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ "completed"
- [ ] –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `reports.report.submitted` –≤ EventOutbox (DATA_MODEL_AND_EVENTS.md ¬ß2.6)
- [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ (>80% coverage)

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
src/
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îî‚îÄ‚îÄ reports.controller.ts
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ reports.service.ts
‚îú‚îÄ‚îÄ validation/
‚îÇ   ‚îî‚îÄ‚îÄ report.schema.ts
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ auth.middleware.ts
‚îÇ   ‚îî‚îÄ‚îÄ rbac.middleware.ts
‚îî‚îÄ‚îÄ routes/
    ‚îî‚îÄ‚îÄ reports.routes.ts
```

---

### –ó–∞–¥–∞—á–∞ 1.1.3: Media Upload Integration (MinIO)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 6 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 1.1.2

#### API Endpoints (Media & Storage Service)

**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç API_CONTRACTS_MVP.md Section 12:**

```typescript
POST   /media/v1/upload/presigned  // –ü–æ–ª—É—á–∏—Ç—å presigned URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
POST   /media/v1/:id/confirm       // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É—Å–ø–µ—à–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
GET    /media/v1/:id               // –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ + download URL
DELETE /media/v1/:id               // –£–¥–∞–ª–∏—Ç—å –º–µ–¥–∏–∞ (soft delete)
```

#### Upload Flow (3 —à–∞–≥–∞)

**–®–∞–≥ 1:** –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç presigned URL
```json
POST /media/v1/upload/presigned
{
  "fileName": "video_session.mp4",
  "contentType": "video/mp4",
  "fileSize": 15728640,
  "ownerType": "report",
  "ownerId": "uuid",
  "expiresIn": 3600
}

Response:
{
  "mediaId": "uuid",
  "uploadUrl": "https://storage.neiro.dev/uploads/...",
  "headers": {
    "Content-Type": "video/mp4",
    "X-Upload-Token": "..."
  },
  "expiresAt": "2025-01-11T11:00:00Z"
}
```

**–®–∞–≥ 2:** –ö–ª–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ presigned URL (MinIO)
```javascript
await fetch(uploadUrl, {
  method: 'PUT',
  headers: headers,
  body: file
});
```

**–®–∞–≥ 3:** –ö–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É
```json
POST /media/v1/:id/confirm
{
  "checksum": "sha256-hash"
}

Response:
{
  "status": "confirmed",
  "url": "https://cdn.neiro.dev/..."
}
```

#### Acceptance Criteria
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: `image/*`, `video/*`, `audio/*` (–≤–∞–ª–∏–¥–∞—Ü–∏—è MIME)
- [ ] –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 10MB (—Ñ–æ—Ç–æ), 100MB (–≤–∏–¥–µ–æ) ‚Äî —Å–æ–≥–ª–∞—Å–Ω–æ API_CONTRACTS_MVP.md:834
- [ ] Presigned URL generation —Å MinIO SDK
- [ ] Sharp –¥–ª—è —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (quality: 80)
- [ ] MinIO bucket: `neiro-reports`
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è thumbnail'–æ–≤ –¥–ª—è —Ñ–æ—Ç–æ (300x300)
- [ ] Presigned URLs —Å expiration = 1 —á–∞—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è `ownerType` enum: `report | diagnostic_session | child_profile`
- [ ] –ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É `media_assets` (polymorphic: owner_type, owner_id)
- [ ] **–í–ê–ñ–ù–û:** –°–æ–±—ã—Ç–∏–µ `media.upload.confirmed` –≤ EventOutbox –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `reports.media.attached` –ø—Ä–∏ –ø—Ä–∏–≤—è–∑–∫–µ –∫ –æ—Ç—á–µ—Ç—É

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
```typescript
// media.service.ts
interface UploadResult {
  mediaAsset: MediaAsset;
  presignedUrl: string;
  thumbnailUrl?: string; // –¥–ª—è —Ñ–æ—Ç–æ
}

// MinIO configuration
const MINIO_CONFIG = {
  endpoint: process.env.MINIO_ENDPOINT,
  port: 9000,
  useSSL: false,
  accessKey: process.env.MINIO_ACCESS_KEY,
  secretKey: process.env.MINIO_SECRET_KEY,
};
```

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ media.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ minio.client.ts
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ upload.middleware.ts
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ image-processor.ts
    ‚îî‚îÄ‚îÄ file-validator.ts
```

---

### –ó–∞–¥–∞—á–∞ 1.1.4: Report Reviews –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 1.1.2

#### API Endpoints

```typescript
GET    /reports/v1/reviews/pending      // –û—Ç—á–µ—Ç—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
POST   /reports/v1/:id/review           // –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
PATCH  /reports/v1/:id/review-status    // –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏
```

#### Request/Response

**POST /reports/v1/:id/review** (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç API_CONTRACTS_MVP.md:771-775)
```json
{
  "reviewStatus": "approved",
  "notes": "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ. –†–µ–∫–æ–º–µ–Ω–¥—É—é —É–≤–µ–ª–∏—á–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è."
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- `reviewStatus`: `"approved" | "needs_attention" | "rejected"` - —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏
- `notes`: `string<=512` - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ (–Ω–µ `specialistNotes`)
- –ü–æ–ª–µ `nextSteps` —É–¥–∞–ª–µ–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `notes` –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- `reviewedBy` –∏ `reviewedAt` –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ JWT token

#### Acceptance Criteria
- [ ] –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä–∏—Ç—å (approved), –∑–∞–ø—Ä–æ—Å–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ (needs_attention) –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å (rejected)
- [ ] –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ review –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `reports.report.reviewed` –≤ EventOutbox
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ `reports`: `reviewed_by`, `reviewed_at`, `review_status`, `review_notes`
- [ ] –§–∏–ª—å—Ç—Ä—ã: –ø–æ —Ä–µ–±–µ–Ω–∫—É, –¥–∞—Ç–µ, —Å—Ç–∞—Ç—É—Å—É –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ (review_status = 'not_reviewed'), –ø–æ—Ç–æ–º –ø–æ submitted_at DESC

#### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è/—Å–æ–∑–¥–∞–Ω–∏—è
```
src/
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îî‚îÄ‚îÄ reviews.controller.ts
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ reviews.service.ts
‚îî‚îÄ‚îÄ routes/
    ‚îî‚îÄ‚îÄ reviews.routes.ts
```

---

## 1.2 Frontend: Report Submission

### –ó–∞–¥–∞—á–∞ 1.2.1: CreateReportDialog Component
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 6 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 1.1.2

#### UI –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

**‚ö†Ô∏è –í–ê–ñ–ù–û:** childMood –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å API_CONTRACTS_MVP.md: `"good" | "neutral" | "difficult"` (3 –∑–Ω–∞—á–µ–Ω–∏—è, –ù–ï 5).

**–§–æ—Ä–º–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
1. Duration slider (0-120 –º–∏–Ω—É—Ç)
2. **Mood selector** (3 –∑–Ω–∞—á–µ–Ω–∏—è):
   - üòä "–•–æ—Ä–æ—à–æ" ‚Üí `childMood: "good"`
   - üòê "–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ" ‚Üí `childMood: "neutral"`
   - üòü "–¢—Ä—É–¥–Ω–æ" ‚Üí `childMood: "difficult"`
3. Notes —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, min 20 —Å–∏–º–≤–æ–ª–æ–≤) ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ `feedbackText`
4. Media upload (drag-and-drop + file picker)
5. –ö–Ω–æ–ø–∫–∏: –û—Ç–º–µ–Ω–∞, –û—Ç–ø—Ä–∞–≤–∏—Ç—å

**‚ö†Ô∏è –£–î–ê–õ–ï–ù–û –∏–∑ —Ñ–æ—Ä–º—ã:**
- ~~Engagement selector~~ - –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –ø–æ–ª—è –≤ Report model
- ~~Difficulties —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ~~ - –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –ø–æ–ª—è –≤ Report model

#### Acceptance Criteria
- [ ] –î–∏–∞–ª–æ–≥ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å" –Ω–∞ Assignment
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è: notes –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, min 20 —Å–∏–º–≤–æ–ª–æ–≤
- [ ] Mood selector - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–º–æ–¥–∑–∏ (hover effect)
- [ ] Duration slider —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
- [ ] Media upload —Å preview –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- [ ] Progress bar –≤–æ –≤—Ä–µ–º—è upload
- [ ] Success toast –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- [ ] Error handling —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- [ ] Responsive –¥–∏–∑–∞–π–Ω (mobile-friendly)

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
apps/web/src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ reports/
‚îÇ       ‚îú‚îÄ‚îÄ CreateReportDialog.tsx
‚îÇ       ‚îú‚îÄ‚îÄ MoodSelector.tsx
‚îÇ       ‚îú‚îÄ‚îÄ DurationSlider.tsx
‚îÇ       ‚îî‚îÄ‚îÄ MediaUploader.tsx
‚îî‚îÄ‚îÄ lib/
    ‚îî‚îÄ‚îÄ api/
        ‚îî‚îÄ‚îÄ reports.ts
```

#### UI Mockup (—Ç–µ–∫—Å—Ç–æ–≤—ã–π)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –û—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏                            [X]  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ  –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: [========|-----] 25 –º–∏–Ω—É—Ç           ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞:                               ‚îÇ
‚îÇ  üòü –¢—Ä—É–¥–Ω–æ   üòê –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ   ‚óè üòä –•–æ—Ä–æ—à–æ           ‚îÇ
‚îÇ  (difficult)  (neutral)        (good)              ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: *                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ –ê–ª–∏—Å–∞ –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∞—Å—å —Å –∑–∞–¥–∞–Ω–∏–µ–º!       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ –ü–æ–∫–∞–∑–∞–ª–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å.             ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –§–æ—Ç–æ/–í–∏–¥–µ–æ:                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
‚îÇ  ‚îÇ  [photo]  ‚îÇ  ‚îÇ  [+Add]   ‚îÇ                     ‚îÇ
‚îÇ  ‚îÇ   üì∑      ‚îÇ  ‚îÇ           ‚îÇ                     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ             [–û—Ç–º–µ–Ω–∞]  [–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç]            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Mapping UI ‚Üí API:**
```typescript
// UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–º–æ–¥–∑–∏, –Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
const moodMapping = {
  'üòü –¢—Ä—É–¥–Ω–æ': 'difficult',
  'üòê –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ': 'neutral',
  'üòä –•–æ—Ä–æ—à–æ': 'good'
};

// API Request
POST /reports/v1
{
  "assignmentId": "uuid",
  "durationMinutes": 25,
  "status": "completed",
  "childMood": "good",  // ‚úÖ –ù–ï "happy" –∏–ª–∏ emoji
  "feedbackText": "–ê–ª–∏—Å–∞ –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∞—Å—å —Å –∑–∞–¥–∞–Ω–∏–µ–º!",  // ‚úÖ –ù–ï "notes"
  "media": [...]
}
```

---

### –ó–∞–¥–∞—á–∞ 1.2.2: Media Upload Component
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 1.1.3, 1.2.1

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- Drag & Drop –∑–æ–Ω–∞
- File picker (–∫–Ω–æ–ø–∫–∞ "–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª")
- Preview –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- Delete –∫–Ω–æ–ø–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
- Progress bar –¥–ª—è –∫–∞–∂–¥–æ–≥–æ upload
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞

#### Acceptance Criteria
- [ ] Drag & Drop —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º feedback)
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (JPEG, PNG, MP4, MOV)
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (max 10MB –¥–ª—è —Ñ–æ—Ç–æ, 100MB –¥–ª—è –≤–∏–¥–µ–æ)
- [ ] Preview –¥–ª—è —Ñ–æ—Ç–æ (thumbnail)
- [ ] Play button –¥–ª—è –≤–∏–¥–µ–æ preview
- [ ] Upload progress –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
- [ ] Retry mechanism –ø—Ä–∏ –æ—à–∏–±–∫–µ upload
- [ ] –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
- [ ] Limit: –º–∞–∫—Å–∏–º—É–º 5 —Ñ–∞–π–ª–æ–≤ –Ω–∞ –æ—Ç—á–µ—Ç

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
```typescript
interface MediaUploaderProps {
  maxFiles?: number;
  maxSizePhoto?: number; // bytes (default: 10MB = 10_485_760 bytes)
  maxSizeVideo?: number; // bytes (default: 100MB = 104_857_600 bytes)
  acceptedFormats?: string[];
  onUploadComplete?: (media: MediaAsset[]) => void;
  onError?: (error: Error) => void;
}

// Defaults —Å–æ–≥–ª–∞—Å–Ω–æ API_CONTRACTS_MVP.md v0.9
const DEFAULT_MAX_SIZE_PHOTO = 10_485_760; // 10MB
const DEFAULT_MAX_SIZE_VIDEO = 104_857_600; // 100MB
```

---

### –ó–∞–¥–∞—á–∞ 1.2.3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Reports –≤ Assignments Page
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 1.2.1, 1.2.2

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç" –¥–ª—è completed assignments
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å badge "–û—Ç—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω" –µ—Å–ª–∏ report —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç ReadReportDialog

#### Acceptance Criteria
- [ ] –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç" –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è completed assignments
- [ ] –ö–Ω–æ–ø–∫–∞ disabled –µ—Å–ª–∏ –æ—Ç—á–µ—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–±–µ–∑ refresh)
- [ ] Badge –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å review: "–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ" / "–û–¥–æ–±—Ä–µ–Ω–æ" / "–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è"

#### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
```
apps/web/src/app/dashboard/assignments/page.tsx
```

---

## 1.3 Frontend: Report Review Dashboard

### –ó–∞–¥–∞—á–∞ 1.3.1: Reports List Page (–¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 6 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 1.1.4

#### UI –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/dashboard/reports`

**–§–∏–ª—å—Ç—Ä—ã:**
- –†–µ–±–µ–Ω–æ–∫ (dropdown, multiple select)
- –°—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤—Å–µ / –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ / –æ–¥–æ–±—Ä–µ–Ω–æ / —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è)
- –î–∞—Ç–∞ (date range picker)

**–°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤ (–∫–∞—Ä—Ç–æ—á–∫–∏):**
- –§–æ—Ç–æ —Ä–µ–±–µ–Ω–∫–∞ + –∏–º—è
- –ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
- –î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- Duration
- Mood (—ç–º–æ–¥–∑–∏)
- Badge —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
- Preview –º–µ–¥–∏–∞ (–ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏ –æ—Ü–µ–Ω–∏—Ç—å"

#### Acceptance Criteria
- [ ] –û—Ç—á–µ—Ç—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è: —Å–Ω–∞—á–∞–ª–∞ –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ, –ø–æ—Ç–æ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
- [ ] –§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç (query params –≤ URL)
- [ ] Infinite scroll –∏–ª–∏ pagination (–ø–æ 20 –æ—Ç—á–µ—Ç–æ–≤)
- [ ] Loading states
- [ ] Empty state: "–ù–µ—Ç –æ—Ç—á–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏"
- [ ] Mobile-responsive

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
apps/web/src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ dashboard/
‚îÇ       ‚îî‚îÄ‚îÄ reports/
‚îÇ           ‚îú‚îÄ‚îÄ page.tsx
‚îÇ           ‚îî‚îÄ‚îÄ layout.tsx
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ reports/
        ‚îú‚îÄ‚îÄ ReportCard.tsx
        ‚îú‚îÄ‚îÄ ReportFilters.tsx
        ‚îî‚îÄ‚îÄ ReportsList.tsx
```

---

### –ó–∞–¥–∞—á–∞ 1.3.2: ReviewReportDialog Component
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 5 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 1.3.1

#### UI –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
**–î–∏–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
1. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç—á–µ—Ç–µ (read-only)
   - –†–µ–±–µ–Ω–æ–∫, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ, –¥–∞—Ç–∞
   - Duration, mood, engagement
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–æ–¥–∏—Ç–µ–ª—è
2. –ì–∞–ª–µ—Ä–µ—è –º–µ–¥–∏–∞ (—Ñ–æ—Ç–æ + –≤–∏–¥–µ–æ –ø–ª–µ–µ—Ä)
3. –§–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
   - Radio buttons: –û–¥–æ–±—Ä–∏—Ç—å / –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è
   - –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
   - –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ: –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –ö–Ω–æ–ø–∫–∏: –ó–∞–∫—Ä—ã—Ç—å, –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–∑—ã–≤

#### Acceptance Criteria
- [ ] –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [ ] –ú–µ–¥–∏–∞ –≤ –≥–∞–ª–µ—Ä–µ–µ (Lightbox –¥–ª—è —Ñ–æ—Ç–æ, Video player –¥–ª—è –≤–∏–¥–µ–æ)
- [ ] –§–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, min 10 —Å–∏–º–≤–æ–ª–æ–≤)
- [ ] –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è
- [ ] Success toast: "–û—Ç–∑—ã–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω"
- [ ] –°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
apps/web/src/components/reports/
‚îú‚îÄ‚îÄ ReviewReportDialog.tsx
‚îú‚îÄ‚îÄ MediaGallery.tsx
‚îî‚îÄ‚îÄ VideoPlayer.tsx
```

---

## 1.4 Testing & Documentation

### –ó–∞–¥–∞—á–∞ 1.4.1: E2E Tests –¥–ª—è Reports
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 1.2.3, 1.3.2

#### –¢–µ—Å—Ç—ã
```typescript
// apps/web/e2e/reports.spec.ts

test.describe('Reports Management', () => {
  test('R-1: –†–æ–¥–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç', async ({ page }) => {
    // 1. Login –∫–∞–∫ parent
    // 2. Navigate to assignments
    // 3. Click "–ó–∞–≤–µ—Ä—à–∏—Ç—å" –Ω–∞ assignment
    // 4. Fill report form
    // 5. Upload photo
    // 6. Submit
    // 7. Verify success message
    // 8. Verify assignment status = completed
  });

  test('R-2: –†–æ–¥–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ', async ({ page }) => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ drag & drop –∏ file picker
  });

  test('R-3: –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç', async ({ page }) => {
    // 1. Login –∫–∞–∫ specialist
    // 2. Navigate to /dashboard/reports
    // 3. Verify –æ—Ç—á–µ—Ç—ã –≤–∏–¥–Ω—ã
    // 4. Click "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å"
    // 5. Verify –º–µ–¥–∏–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
  });

  test('R-4: –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤', async ({ page }) => {
    // 1. Open report
    // 2. Fill review form
    // 3. Submit
    // 4. Verify status –∏–∑–º–µ–Ω–∏–ª—Å—è
  });
});
```

#### Acceptance Criteria
- [ ] –í—Å–µ 4+ —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç happy path + error cases
- [ ] Screenshots –¥–ª—è failing tests
- [ ] Seed –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (assignments + reports)

---

### –ó–∞–¥–∞—á–∞ 1.4.2: API Documentation (Swagger)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 1.1.4

#### Acceptance Criteria
- [ ] Swagger UI –¥–æ—Å—Ç—É–ø–µ–Ω: http://localhost:4009/api-docs
- [ ] –í—Å–µ endpoints –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Request/Response –ø—Ä–∏–º–µ—Ä—ã
- [ ] Authentication –æ–ø–∏—Å–∞–Ω (JWT Bearer)
- [ ] Error responses –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
services/reports/src/
‚îú‚îÄ‚îÄ swagger/
‚îÇ   ‚îî‚îÄ‚îÄ openapi.yaml
‚îî‚îÄ‚îÄ routes/
    ‚îî‚îÄ‚îÄ docs.routes.ts
```

---

## Week 1 Deliverables Checklist

### Backend
- [ ] Reports Service —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 4009
- [ ] CRUD API –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤ (5 endpoints)
- [ ] Media upload —Å MinIO –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- [ ] Report reviews API –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
- [ ] Events –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ EventOutbox
- [ ] Health check —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Unit-—Ç–µ—Å—Ç—ã (>80% coverage)
- [ ] API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Swagger)

### Frontend
- [ ] CreateReportDialog —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
- [ ] Media upload component (drag & drop + preview)
- [ ] Integration –≤ Assignments page
- [ ] Reports list page –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
- [ ] ReviewReportDialog –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤
- [ ] E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (4+ —Ç–µ—Å—Ç–æ–≤)

### Infrastructure
- [ ] Reports service –¥–æ–±–∞–≤–ª–µ–Ω –≤ docker-compose.yml —Å healthcheck
- [ ] MinIO bucket `neiro-reports` —Å–æ–∑–¥–∞–Ω
- [ ] Database migrations (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã)

**–ü—Ä–∏–º–µ—Ä docker-compose.yml —Å healthcheck:**
```yaml
services:
  reports:
    build: ./services/reports
    ports:
      - "4009:4009"
    environment:
      DATABASE_URL: postgres://neiro_user:neiro_password_dev@postgres:5432/neiro_platform
      MINIO_ENDPOINT: http://minio:9000
      MINIO_ACCESS_KEY: minioadmin
      MINIO_SECRET_KEY: minioadmin123
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4009/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    depends_on:
      postgres:
        condition: service_healthy
      minio:
        condition: service_started
```

**Health check endpoint –≤ Reports Service:**
```typescript
// services/reports/src/routes/health.ts
app.get('/health', async (req, res) => {
  try {
    await prisma.$queryRaw`SELECT 1`;  // Check DB
    await minioClient.bucketExists('neiro-reports');  // Check MinIO
    res.status(200).json({ status: 'healthy' });
  } catch (error) {
    res.status(503).json({ status: 'unhealthy', error: error.message });
  }
});
```

---

## Week 1 Exit Criteria (Go/No-Go –¥–ª—è Week 2)

### ‚úÖ Must-Have (P0) - –±–ª–æ–∫–µ—Ä—ã Week 2:
- [ ] **Functional:** –†–æ–¥–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç —Å 1+ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ UI
- [ ] **Functional:** –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤–∏–¥–∏—Ç –æ—Ç—á–µ—Ç –∏ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å review (approve/reject)
- [ ] **Technical:** Reports Service healthy –∏ –æ—Ç–≤–µ—á–∞–µ—Ç < 200ms (p95)
- [ ] **Technical:** MinIO —Ö—Ä–∞–Ω–∏—Ç —Ñ–∞–π–ª—ã, thumbnails –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
- [ ] **Tests:** –ú–∏–Ω–∏–º—É–º 4 E2E —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç (report creation, media upload, review, list)
- [ ] **Integration:** EventOutbox –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è `report.submitted`, `report.reviewed`

### üìä Success Metrics (–∏–∑–º–µ—Ä–∏–º—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏):
- [ ] **API Performance:** `GET /reports` < 100ms (p95), `POST /reports` < 300ms (p95)
- [ ] **File Upload:** –§–æ—Ç–æ –¥–æ 10MB –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è < 5 —Å–µ–∫—É–Ω–¥
- [ ] **Test Coverage:** Backend >80%, Frontend >70%
- [ ] **Error Rate:** < 1% failed requests –≤ —Ä—É—á–Ω–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

### üìã Nice-to-Have (P1) - –Ω–µ –±–ª–æ–∫–µ—Ä—ã:
- [ ] Video upload —Ä–∞–±–æ—Ç–∞–µ—Ç (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å –Ω–∞ Week 2)
- [ ] Report list pagination (–¥–ª—è >100 –æ—Ç—á–µ—Ç–æ–≤)
- [ ] Media preview lightbox (–º–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å)

### üö® Red Flags (–ø—Ä–∏—á–∏–Ω—ã –¥–ª—è No-Go –≤ Week 2):
- ‚ùå MinIO storage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ —Ñ–∞–π–ª—ã —Ç–µ—Ä—è—é—Ç—Å—è
- ‚ùå Reports API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç >5% errors
- ‚ùå E2E —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç >50% –ø—Ä–æ–≥–æ–Ω–æ–≤ (flaky tests)
- ‚ùå –ö—Ä–∏—Ç–∏—á–Ω—ã–π –±–∞–≥: –æ—Ç—á–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î

### üîÑ Burn-Down Tracking:
**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ:** 40 —á–∞—Å–æ–≤
**P0 –∑–∞–¥–∞—á–∏:** 32 —á–∞—Å–∞ (80%)
**P1 –∑–∞–¥–∞—á–∏:** 8 —á–∞—Å–æ–≤ (20%)

**Burn-down –ø—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ –∫ —Å–µ—Ä–µ–¥–∏–Ω–µ –Ω–µ–¥–µ–ª–∏ (20—á) –≤—ã–ø–æ–ª–Ω–µ–Ω–æ <40% P0 –∑–∞–¥–∞—á, —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—Å–µ—Ö P1 –∑–∞–¥–∞—á –∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ P0.

---

# üìÖ WEEK 2: ANALYTICS & PROGRESS TRACKING

**–¶–µ–ª—å:** –†–æ–¥–∏—Ç–µ–ª–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –≤–∏–¥—è—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏

**–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:** 36 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)

---

## 2.1 Backend: Analytics Service

### –ó–∞–¥–∞—á–∞ 2.1.1: Analytics Service Setup
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –Ω–µ—Ç

#### Acceptance Criteria
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞ —Å–æ–∑–¥–∞–Ω–∞
- [ ] Dockerfile + docker-compose integration (–ø–æ—Ä—Ç 4010)
- [ ] Health check endpoint
- [ ] Prisma Client –Ω–∞—Å—Ç—Ä–æ–µ–Ω

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
services/analytics/
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ index.ts
    ‚îî‚îÄ‚îÄ app.ts
```

---

### –ó–∞–¥–∞—á–∞ 2.1.2: Child Progress API
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 8 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1.1

#### API Endpoints

‚úÖ **–ü–†–ò–ú–ï–ß–ê–ù–ò–ï:** –≠—Ç–∏ endpoints –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ API_CONTRACTS_MVP.md v0.9 (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 22 –Ω–æ—è–±—Ä—è 2025).

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è:** –°–º. API_CONTRACTS_MVP.md Section 11.1 (Analytics Detailed Endpoints):
- `GET /analytics/v1/children/:childId/progress`
- `GET /analytics/v1/children/:childId/assignments-stats`
- `GET /analytics/v1/children/:childId/goals-progress`
- `GET /analytics/v1/children/:childId/timeline`
- `GET /analytics/v1/routes/:routeId/progress`
- `GET /analytics/v1/specialists/:specialistId/performance`

–°–º. –ø–æ–ª–Ω—ã–µ request/response –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤ API_CONTRACTS_MVP.md v0.9 –¥–ª—è —Ç–æ—á–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤.

```typescript
GET /analytics/v1/children/:childId/progress
GET /analytics/v1/children/:childId/assignments-stats
GET /analytics/v1/children/:childId/goals-progress
GET /analytics/v1/children/:childId/timeline
```

#### Response Examples

**GET /analytics/v1/children/:childId/progress**
```json
{
  "success": true,
  "data": {
    "childId": "uuid",
    "overallProgress": 67.5,
    "assignments": {
      "total": 40,
      "completed": 27,
      "completionRate": 67.5,
      "averageDuration": 22.5,
      "onTime": 25,
      "late": 2
    },
    "goals": {
      "total": 12,
      "achieved": 5,
      "achievementRate": 41.7
    },
    "mood": {
      "good": 18,
      "neutral": 7,
      "difficult": 2
    },
    "currentPhase": {
      "id": "uuid",
      "name": "–§–∞–∑–∞ 2",
      "progress": 75.0
    }
  }
}
```

**GET /analytics/v1/children/:childId/assignments-stats**
```json
{
  "success": true,
  "data": {
    "timeSeries": [
      { "date": "2025-01-01", "completed": 3, "scheduled": 5 },
      { "date": "2025-01-02", "completed": 4, "scheduled": 4 }
    ],
    "byExerciseType": {
      "speech": { "total": 12, "completed": 10 },
      "motor": { "total": 10, "completed": 8 },
      "cognitive": { "total": 8, "completed": 6 }
    },
    "byDeliveryChannel": {
      "in_person": 15,
      "home": 10,
      "telepractice": 2
    }
  }
}
```

#### Acceptance Criteria
- [ ] –í—Å–µ 4 endpoint'–∞ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Assignment, Report, RouteGoal
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis (TTL = 5 –º–∏–Ω—É—Ç)
- [ ] Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: startDate, endDate –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- [ ] RBAC: —Ä–æ–¥–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö –¥–µ—Ç–µ–π
- [ ] RBAC: —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–µ—Ç–µ–π
- [ ] Performance: –∑–∞–ø—Ä–æ—Å—ã < 500ms

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
src/
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îî‚îÄ‚îÄ progress.controller.ts
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ aggregation.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ metrics.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ cache.service.ts
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ date-helpers.ts
```

---

### –ó–∞–¥–∞—á–∞ 2.1.3: Route Progress API
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1.2

#### API Endpoints

```typescript
GET /analytics/v1/routes/:routeId/progress
GET /analytics/v1/routes/:routeId/phases
GET /analytics/v1/routes/:routeId/milestones
```

#### Response Example

**GET /analytics/v1/routes/:routeId/progress**
```json
{
  "success": true,
  "data": {
    "routeId": "uuid",
    "title": "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç - –ê–ª–∏—Å–∞",
    "status": "active",
    "startDate": "2024-09-01",
    "overallProgress": 45.5,
    "phases": [
      {
        "id": "uuid",
        "name": "–§–∞–∑–∞ 1: –ê–¥–∞–ø—Ç–∞—Ü–∏—è",
        "progress": 100,
        "status": "completed"
      },
      {
        "id": "uuid",
        "name": "–§–∞–∑–∞ 2: –†–∞–∑–≤–∏—Ç–∏–µ —Ä–µ—á–∏",
        "progress": 75,
        "status": "active"
      }
    ],
    "goals": [
      {
        "id": "uuid",
        "description": "–£–ª—É—á—à–∏—Ç—å –∞—Ä—Ç–∏–∫—É–ª—è—Ü–∏—é –∑–≤—É–∫–∞ –†",
        "achieved": true,
        "achievedAt": "2024-12-15"
      }
    ]
  }
}
```

#### Acceptance Criteria
- [ ] –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ —Ñ–∞–∑–∞–º
- [ ] –†–∞—Å—á–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π
- [ ] Timeline –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π (milestones)
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

### –ó–∞–¥–∞—á–∞ 2.1.4: Specialist Overview API
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1.2

#### API Endpoint

```typescript
GET /analytics/v1/specialists/:specialistId/overview
```

#### Response
```json
{
  "success": true,
  "data": {
    "specialistId": "uuid",
    "children": {
      "total": 8,
      "active": 7,
      "paused": 1
    },
    "assignments": {
      "total": 156,
      "completed": 120,
      "pending": 36,
      "completionRate": 76.9
    },
    "reports": {
      "pending": 5,
      "reviewedToday": 8
    },
    "topPerformers": [
      { "childId": "uuid", "name": "–ê–ª–∏—Å–∞", "completionRate": 92.5 },
      { "childId": "uuid", "name": "–ë–æ—Ä–∏—Å", "completionRate": 85.0 }
    ],
    "needsAttention": [
      { "childId": "uuid", "name": "–í–∏–∫—Ç–æ—Ä", "completionRate": 55.0 }
    ]
  }
}
```

#### Acceptance Criteria
- [ ] –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –≤—Å–µ–º –¥–µ—Ç—è–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
- [ ] –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è top performers –∏ needs attention
- [ ] Dashboard-ready data format

---

## 2.2 Frontend: Parent Progress Dashboard

### –ó–∞–¥–∞—á–∞ 2.2.1: Progress Page Layout
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1.2

#### UI –°—Ç—Ä—É–∫—Ç—É—Ä–∞
**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/dashboard/progress`

**–°–µ–∫—Ü–∏–∏:**
1. Header —Å –≤—ã–±–æ—Ä–æ–º —Ä–µ–±–µ–Ω–∫–∞ (–µ—Å–ª–∏ –¥–µ—Ç–µ–π –Ω–µ—Å–∫–æ–ª—å–∫–æ)
2. KPI Cards (4 –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —Ä—è–¥)
   - –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π
   - –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
   - –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ —Ü–µ–ª–µ–π
   - –¢–µ–∫—É—â–∞—è —Ñ–∞–∑–∞ –º–∞—Ä—à—Ä—É—Ç–∞
3. Charts Section (2 –∫–æ–ª–æ–Ω–∫–∏)
   - Assignment Completion Timeline (line chart)
   - Mood Distribution (pie chart)
4. Goals Progress (progress bars)
5. Recent Activity (—Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ç—á–µ—Ç–æ–≤)

#### Acceptance Criteria
- [ ] Responsive grid layout (mobile: 1 col, tablet: 2 col, desktop: 4 col)
- [ ] Loading skeletons –¥–ª—è –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π
- [ ] Error states —Å retry buttons
- [ ] Date range picker –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (last 7 days, 30 days, 90 days, all time)
- [ ] Data auto-refresh –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
apps/web/src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ dashboard/
‚îÇ       ‚îî‚îÄ‚îÄ progress/
‚îÇ           ‚îú‚îÄ‚îÄ page.tsx
‚îÇ           ‚îî‚îÄ‚îÄ loading.tsx
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ analytics/
        ‚îú‚îÄ‚îÄ KPICard.tsx
        ‚îú‚îÄ‚îÄ DateRangeFilter.tsx
        ‚îî‚îÄ‚îÄ ProgressHeader.tsx
```

---

### –ó–∞–¥–∞—á–∞ 2.2.2: Charts Implementation
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 6 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.2.1

#### Charts Library
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Recharts** (—É–∂–µ –≤ dependencies?)

#### Charts Types
1. **Line Chart** - Assignment completion over time
2. **Pie Chart** - Mood distribution
3. **Bar Chart** - Exercise types distribution
4. **Progress Bars** - Goals achievement

#### Acceptance Criteria
- [ ] Responsive charts (–∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
- [ ] Tooltips —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- [ ] Legend –¥–ª—è –≤—Å–µ—Ö charts
- [ ] –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç design system
- [ ] –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- [ ] Empty state: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏"

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
```typescript
// Chart data format
interface ChartData {
  labels: string[];
  datasets: {
    label: string;
    data: number[];
    backgroundColor?: string[];
    borderColor?: string;
  }[];
}
```

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
apps/web/src/components/analytics/
‚îú‚îÄ‚îÄ LineChart.tsx
‚îú‚îÄ‚îÄ PieChart.tsx
‚îú‚îÄ‚îÄ BarChart.tsx
‚îî‚îÄ‚îÄ ProgressBar.tsx
```

---

### –ó–∞–¥–∞—á–∞ 2.2.3: Goals Progress Section
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1.2

#### UI –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
**–ö–∞–∂–¥–∞—è —Ü–µ–ª—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫:**
- –ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏
- Progress bar (0-100%)
- Badge —Å—Ç–∞—Ç—É—Å–∞ (active / achieved / paused)
- Target date
- Description (expandable)

#### Acceptance Criteria
- [ ] –¶–µ–ª–∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è: –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–µ—Ä–≤—ã–º–∏, –∑–∞—Ç–µ–º –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ
- [ ] Progress bar —Ü–≤–µ—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (red < 50%, yellow 50-80%, green > 80%)
- [ ] Achieved goals –ø–æ–º–µ—á–µ–Ω—ã –∑–µ–ª–µ–Ω–æ–π –≥–∞–ª–æ—á–∫–æ–π
- [ ] Expandable description (click to expand)

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
apps/web/src/components/analytics/
‚îú‚îÄ‚îÄ GoalProgress.tsx
‚îî‚îÄ‚îÄ GoalCard.tsx
```

---

## 2.3 Frontend: Specialist Analytics Dashboard

### –ó–∞–¥–∞—á–∞ 2.3.1: Specialist Overview Page
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 5 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1.4

#### UI –°—Ç—Ä—É–∫—Ç—É—Ä–∞
**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/dashboard/specialist/analytics`

**–°–µ–∫—Ü–∏–∏:**
1. Overview KPIs (–∫–∞—Ä—Ç–æ—á–∫–∏)
   - Total Children
   - Total Assignments
   - Completion Rate
   - Pending Reports
2. Top Performers (—Å–ø–∏—Å–æ–∫ –¥–µ—Ç–µ–π —Å –≤—ã—Å–æ–∫–∏–º completion rate)
3. Needs Attention (—Å–ø–∏—Å–æ–∫ –¥–µ—Ç–µ–π —Å –Ω–∏–∑–∫–∏–º completion rate)
4. Recent Reports to Review
5. Charts:
   - Completion rates comparison (bar chart)
   - Activity heatmap (calendar view)

#### Acceptance Criteria
- [ ] –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å `/analytics/v1/specialists/:id/overview`
- [ ] Click –Ω–∞ —Ä–µ–±–µ–Ω–∫–∞ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –µ–≥–æ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- [ ] –§–∏–ª—å—Ç—Ä—ã: active children only / all children
- [ ] Export to CSV (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
apps/web/src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ dashboard/
‚îÇ       ‚îî‚îÄ‚îÄ specialist/
‚îÇ           ‚îî‚îÄ‚îÄ analytics/
‚îÇ               ‚îî‚îÄ‚îÄ page.tsx
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ analytics/
        ‚îú‚îÄ‚îÄ SpecialistOverview.tsx
        ‚îú‚îÄ‚îÄ ChildrenComparison.tsx
        ‚îî‚îÄ‚îÄ ActivityHeatmap.tsx
```

---

## 2.4 Testing & Documentation

### –ó–∞–¥–∞—á–∞ 2.4.1: E2E Tests –¥–ª—è Progress Dashboard
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.2.3, 2.3.1

#### –¢–µ—Å—Ç—ã
```typescript
// apps/web/e2e/progress.spec.ts

test.describe('Progress Dashboard', () => {
  test('PR-1: –†–æ–¥–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–µ–±–µ–Ω–∫–∞', async ({ page }) => {
    // 1. Login –∫–∞–∫ parent
    // 2. Navigate to /dashboard/progress
    // 3. Verify KPI cards visible
    // 4. Verify charts loaded
    // 5. Verify goals section visible
  });

  test('PR-2: –ì—Ä–∞—Ñ–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', async ({ page }) => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ charts rendered
  });

  test('PR-3: –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤–∏–¥–∏—Ç –æ–±–∑–æ—Ä –¥–µ—Ç–µ–π', async ({ page }) => {
    // 1. Login –∫–∞–∫ specialist
    // 2. Navigate to /dashboard/specialist/analytics
    // 3. Verify overview data
    // 4. Verify top performers list
  });
});
```

#### Acceptance Criteria
- [ ] –í—Å–µ 3+ —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ charts rendered (screenshot comparison)
- [ ] Seed –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

---

## Week 2 Deliverables Checklist

### Backend
- [ ] Analytics Service —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –ø–æ—Ä—Ç—É 4010
- [ ] Child progress API (4 endpoints)
- [ ] Route progress API (3 endpoints)
- [ ] Specialist overview API
- [ ] Redis caching –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–π
- [ ] Health check —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Unit-—Ç–µ—Å—Ç—ã (>70% coverage)

### Frontend
- [ ] Progress dashboard –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π (/dashboard/progress)
- [ ] Charts implementation (line, pie, bar)
- [ ] Goals progress section
- [ ] Specialist analytics page
- [ ] E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (3+ —Ç–µ—Å—Ç–æ–≤)
- [ ] Responsive design

### Infrastructure
- [ ] Analytics service –≤ docker-compose.yml —Å healthcheck
- [ ] Redis cache configured

**–ü—Ä–∏–º–µ—Ä docker-compose.yml —Å healthcheck:**
```yaml
services:
  analytics:
    build: ./services/analytics
    ports:
      - "4010:4010"
    environment:
      DATABASE_URL: postgres://neiro_user:neiro_password_dev@postgres:5432/neiro_platform
      REDIS_URL: redis://redis:6379
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4010/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_started
```

**Health check endpoint –≤ Analytics Service:**
```typescript
// services/analytics/src/routes/health.ts
app.get('/health', async (req, res) => {
  try {
    await prisma.$queryRaw`SELECT 1`;  // Check DB
    await redisClient.ping();  // Check Redis
    res.status(200).json({ status: 'healthy' });
  } catch (error) {
    res.status(503).json({ status: 'unhealthy', error: error.message });
  }
});
```

---

## Week 2 Exit Criteria (Go/No-Go –¥–ª—è Week 3)

### ‚úÖ Must-Have (P0) - –±–ª–æ–∫–µ—Ä—ã Week 3:
- [ ] **Functional:** –†–æ–¥–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–µ–±–µ–Ω–∫–∞ —Å 2+ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ (completion rate, activity over time)
- [ ] **Functional:** –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤–∏–¥–∏—Ç overview dashboards —Å key metrics (assignments, completion, avg rating)
- [ ] **Technical:** Analytics Service healthy –∏ –æ—Ç–≤–µ—á–∞–µ—Ç < 300ms (p95) —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- [ ] **Technical:** Redis –∫—ç—à —Ä–∞–±–æ—Ç–∞–µ—Ç, cache hit rate >70%
- [ ] **Tests:** –ú–∏–Ω–∏–º—É–º 3 E2E —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç (progress view, charts render, specialist dashboard)
- [ ] **Data:** –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è >10 assignments

### üìä Success Metrics (–∏–∑–º–µ—Ä–∏–º—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏):
- [ ] **API Performance:** `GET /analytics/child/{id}/progress` < 200ms (p95, cached), < 500ms (uncached)
- [ ] **Cache Performance:** Redis TTL 5 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, cache invalidation —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –Ω–æ–≤—ã—Ö –æ—Ç—á–µ—Ç–∞—Ö
- [ ] **Test Coverage:** Backend >70%, Frontend >65%
- [ ] **Data Accuracy:** Completion rate ¬± 1% –æ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ seed data)

### üìã Nice-to-Have (P1) - –Ω–µ –±–ª–æ–∫–µ—Ä—ã:
- [ ] Advanced charts (heatmap, radar)
- [ ] Export to PDF/Excel
- [ ] Multi-child comparison –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π —Å 2+ –¥–µ—Ç—å–º–∏

### üö® Red Flags (–ø—Ä–∏—á–∏–Ω—ã –¥–ª—è No-Go –≤ Week 3):
- ‚ùå Redis cache –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ cache invalidation –ª–æ–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚ùå Analytics API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (>10% —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ)
- ‚ùå Charts –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏–ª–∏ –ø–∞–¥–∞–µ—Ç frontend –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ
- ‚ùå P95 latency > 1 —Å–µ–∫—É–Ω–¥–∞ –¥–∞–∂–µ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### üîÑ Burn-Down Tracking:
**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ:** 36 —á–∞—Å–æ–≤
**P0 –∑–∞–¥–∞—á–∏:** 30 —á–∞—Å–æ–≤ (83%)
**P1 –∑–∞–¥–∞—á–∏:** 6 —á–∞—Å–æ–≤ (17%)

**Burn-down –ø—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ –∫ —Å–µ—Ä–µ–¥–∏–Ω–µ –Ω–µ–¥–µ–ª–∏ (18—á) –≤—ã–ø–æ–ª–Ω–µ–Ω–æ <45% P0 –∑–∞–¥–∞—á, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤—Å—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é (charts) –∏ –æ—Ç–¥–∞—Ç—å mock data –¥–ª—è Week 3.

---

# üìÖ WEEK 3: NOTIFICATIONS SYSTEM

**–¶–µ–ª—å:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö

**–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:** 28 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 (–≤—ã—Å–æ–∫–∏–π)

---

## 3.1 Backend: Notifications Service

### –ó–∞–¥–∞—á–∞ 3.1.1: Notifications Service Setup
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –Ω–µ—Ç

#### Acceptance Criteria
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞ —Å–æ–∑–¥–∞–Ω–∞
- [ ] Dockerfile + docker-compose (–ø–æ—Ä—Ç 4011)
- [ ] Health check endpoint
- [ ] NodeMailer configured (SMTP)

#### NPM Dependencies
```json
{
  "nodemailer": "^6.9.7",
  "handlebars": "^4.7.8",
  "node-cron": "^3.0.3",
  "web-push": "^3.6.6"
}
```

---

### –ó–∞–¥–∞—á–∞ 3.1.2: Notifications API Architecture
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 6 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 3.1.1

#### ‚ö†Ô∏è –í–ê–ñ–ù–û: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ª–æ–µ–≤

–°–æ–≥–ª–∞—Å–Ω–æ **NOTIFICATIONS_SPLIT_PROPOSAL.md**, —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ **–¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–ª–æ—è**:

1. **Delivery Tracking Layer** (`notifications` table) - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ —á–µ—Ä–µ–∑ email/SMS/push
2. **UI Layer** (`user_notifications` table) - in-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

**–ó–∞—á–µ–º —Ä–∞–∑–¥–µ–ª—è—Ç—å?**
- Delivery tracking: channel, template, retry logic, delivery status (sent/failed)
- UI notifications: title, body, read/unread status, links
- –†–∞–∑–Ω—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã: email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞–∑, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—á–∏—Ç–∞–Ω –≤ UI –º–Ω–æ–≥–æ —Ä–∞–∑

#### API Endpoints: Delivery Tracking (Internal)

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–æ–≤** –¥–ª—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥—å –¥–æ—Å—Ç–∞–≤–∫–∏.

```typescript
POST /notifications/v1  // –ü–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –¥–æ—Å—Ç–∞–≤–∫–∏ (internal only)
```

**Request Example:**
```json
{
  "recipientId": "uuid",
  "channel": "email",  // email | sms | push | telegram
  "template": "assignment_reminder",
  "payload": {
    "assignmentId": "uuid",
    "assignmentTitle": "–ê—Ä—Ç–∏–∫—É–ª—è—Ü–∏–æ–Ω–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞",
    "scheduledTime": "15:00",
    "parentName": "–ò–≤–∞–Ω"
  },
  "scheduledAt": "2025-01-22T14:00:00Z"  // Optional - –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "recipientId": "uuid",
    "channel": "email",
    "template": "assignment_reminder",
    "status": "pending",  // pending | sent | failed | bounced
    "scheduledAt": "2025-01-22T14:00:00Z",
    "createdAt": "2025-01-21T10:00:00Z"
  }
}
```

#### API Endpoints: User Notifications (Public)

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º** –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è in-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

```typescript
GET    /user-notifications/v1           // –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è UI
GET    /user-notifications/v1/:id       // –î–µ—Ç–∞–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
PATCH  /user-notifications/v1/:id/read  // –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º
PATCH  /user-notifications/v1/read-all  // –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏
DELETE /user-notifications/v1/:id       // –£–¥–∞–ª–∏—Ç—å (soft delete)

GET    /notification-preferences/v1     // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
PATCH  /notification-preferences/v1     // –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

**Response Example: GET /user-notifications/v1**
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "uuid",
        "userId": "uuid",
        "type": "assignment_reminder",
        "title": "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–¥–∞–Ω–∏–∏",
        "body": "–°–µ–≥–æ–¥–Ω—è –≤ 15:00 - –ü–∞–ª—å—á–∏–∫–æ–≤–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞ –¥–ª—è –ê–ª–∏—Å—ã",
        "link": "/dashboard/assignments/uuid",
        "status": "unread",  // unread | read | archived
        "readAt": null,
        "createdAt": "2025-01-21T10:00:00Z"
      },
      {
        "id": "uuid2",
        "userId": "uuid",
        "type": "report_reviewed",
        "title": "–û—Ç—á—ë—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω",
        "body": "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∏–ª –æ—Ç—á—ë—Ç –∑–∞ 20.01.2025. –°—Ç–∞—Ç—É—Å: –û–¥–æ–±—Ä–µ–Ω–æ",
        "link": "/dashboard/reports/uuid2",
        "status": "read",
        "readAt": "2025-01-21T11:30:00Z",
        "createdAt": "2025-01-21T11:00:00Z"
      }
    ],
    "total": 15,
    "unread": 3
  }
}
```

**Response Example: GET /notification-preferences/v1**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "userId": "uuid",
    "emailEnabled": true,
    "inAppEnabled": true,
    "assignmentReminders": true,
    "reportUpdates": true,
    "routeChanges": false,
    "updatedAt": "2025-01-21T10:00:00Z"
  }
}
```

**Request Example: PATCH /notification-preferences/v1**
```json
{
  "assignmentReminders": false,
  "reportUpdates": true
}
```

#### Acceptance Criteria
- [ ] **Delivery API**: POST endpoint –¥–ª—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –æ—á–µ—Ä–µ–¥—å (internal only)
- [ ] **UI API**: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è user_notifications
- [ ] **Preferences API**: GET/PATCH –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –§–∏–ª—å—Ç—Ä—ã: read/unread, –ø–æ —Ç–∏–ø—É, –ø–æ –¥–∞—Ç–µ
- [ ] Pagination (–ø–æ 20 items)
- [ ] RBAC: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] Soft delete –¥–ª—è user_notifications
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü `user_notifications` –∏ `notification_preferences`
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π `recipientId`, `template`, `lastError` –≤ `notifications`

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
services/notifications/src/
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ delivery.controller.ts        # Internal delivery API
‚îÇ   ‚îú‚îÄ‚îÄ user-notifications.controller.ts  # Public UI API
‚îÇ   ‚îî‚îÄ‚îÄ preferences.controller.ts     # Preferences API
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ delivery.service.ts           # Queue notifications for delivery
‚îÇ   ‚îú‚îÄ‚îÄ user-notifications.service.ts # Manage UI notifications
‚îÇ   ‚îî‚îÄ‚îÄ preferences.service.ts        # Manage user preferences
‚îî‚îÄ‚îÄ migrations/
    ‚îú‚îÄ‚îÄ add-user-notifications-table.sql
    ‚îî‚îÄ‚îÄ add-notification-preferences-table.sql
```

---

### –ó–∞–¥–∞—á–∞ 3.1.3: Email Delivery Service
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 6 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 3.1.2

#### Email Provider
**–û–ø—Ü–∏–∏:**
1. **SendGrid** (recommended) - free tier 100 emails/day
2. **AWS SES** - $0.10 per 1000 emails
3. **Gmail SMTP** - –¥–ª—è dev/test (–Ω–µ –¥–ª—è production)

#### Email Templates (Handlebars)

**Assignment Reminder:**
```html
<!-- templates/assignment-reminder.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–¥–∞–Ω–∏–∏</title>
</head>
<body>
  <h2>–ü—Ä–∏–≤–µ—Ç, {{parentName}}!</h2>
  <p>–ù–∞–ø–æ–º–∏–Ω–∞–µ–º –æ –∑–∞–¥–∞–Ω–∏–∏ –¥–ª—è {{childName}}:</p>

  <div style="background: #f5f5f5; padding: 20px; border-radius: 8px;">
    <h3>{{assignmentTitle}}</h3>
    <p><strong>–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong> {{dueDate}}</p>
    <p><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{duration}} –º–∏–Ω—É—Ç</p>
  </div>

  <a href="{{assignmentUrl}}" style="...">–û—Ç–∫—Ä—ã—Ç—å –∑–∞–¥–∞–Ω–∏–µ</a>
</body>
</html>
```

#### Acceptance Criteria
- [ ] NodeMailer –Ω–∞—Å—Ç—Ä–æ–µ–Ω (SMTP credentials –≤ .env)
- [ ] Handlebars templates –¥–ª—è 5+ —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] Email queue (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫)
- [ ] Retry mechanism (3 –ø–æ–ø—ã—Ç–∫–∏ —Å exponential backoff)
- [ ] Email delivery tracking (sent, failed)
- [ ] Unsubscribe link –≤ –∫–∞–∂–¥–æ–º email
- [ ] HTML + Plain text versions

#### –¢–∏–ø—ã Email Templates
1. `assignment-reminder.html` - –ó–∞ 24—á –¥–æ —Å—Ä–æ–∫–∞
2. `assignment-overdue.html` - –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ
3. `report-submitted.html` - –†–æ–¥–∏—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –æ—Ç—á–µ—Ç (‚Üí —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É)
4. `report-reviewed.html` - –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∏–ª –æ—Ç—á–µ—Ç (‚Üí —Ä–æ–¥–∏—Ç–µ–ª—é)
5. `welcome-email.html` - –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º—É

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
services/notifications/src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ email.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ queue.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ webhook.service.ts          # NEW: SendGrid webhook handler
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ assignment-reminder.html
‚îÇ   ‚îú‚îÄ‚îÄ assignment-overdue.html
‚îÇ   ‚îú‚îÄ‚îÄ report-submitted.html
‚îÇ   ‚îú‚îÄ‚îÄ report-reviewed.html
‚îÇ   ‚îî‚îÄ‚îÄ welcome-email.html
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ webhooks.ts                  # NEW: Webhook endpoint
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ template-renderer.ts
```

#### SendGrid Webhooks –¥–ª—è Email Delivery Monitoring

**–¶–µ–ª—å:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å delivery rate, bounces, spam complaints –¥–ª—è –º–µ—Ç—Ä–∏–∫

**SendGrid Events:**
- `delivered` - Email —É—Å–ø–µ—à–Ω–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
- `open` - Email –æ—Ç–∫—Ä—ã—Ç (–µ—Å–ª–∏ tracking enabled)
- `click` - –ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ
- `bounce` - Hard bounce (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π email)
- `dropped` - SendGrid –æ—Ç–∫–ª–æ–Ω–∏–ª (spam/unsubscribed)
- `spam_report` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ—Ç–∏–ª –∫–∞–∫ spam
- `unsubscribe` - –û—Ç–ø–∏—Å–∫–∞ –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏

**Webhook Endpoint:**
```typescript
// services/notifications/src/routes/webhooks.ts
import { Router } from 'express';
import crypto from 'crypto';

const router = Router();

// POST /webhooks/sendgrid
router.post('/sendgrid', async (req, res) => {
  // 1. Verify SendGrid signature
  const signature = req.headers['x-twilio-email-event-webhook-signature'];
  const timestamp = req.headers['x-twilio-email-event-webhook-timestamp'];

  if (!verifySignature(signature, timestamp, req.body)) {
    return res.status(401).json({ error: 'Invalid signature' });
  }

  // 2. Process events
  const events = req.body; // Array of events

  for (const event of events) {
    await processWebhookEvent(event);
  }

  res.status(200).json({ received: events.length });
});

async function processWebhookEvent(event: any) {
  const { event: eventType, email, timestamp, notification_id } = event;

  // Update Notification status
  await prisma.notification.update({
    where: { id: notification_id },
    data: {
      status: eventType === 'delivered' ? 'sent' :
              eventType === 'bounce' ? 'failed' :
              'sent',
      sentAt: eventType === 'delivered' ? new Date(timestamp * 1000) : undefined,
    }
  });

  // Track metrics
  await prisma.emailMetric.create({
    data: {
      notificationId: notification_id,
      event: eventType,
      email,
      timestamp: new Date(timestamp * 1000),
      metadata: event,
    }
  });

  // Alert on critical events
  if (eventType === 'bounce' || eventType === 'spam_report') {
    console.warn(`‚ö†Ô∏è  Email ${eventType}: ${email}`);
    // TODO: Add alerting (Slack/Telegram)
  }
}

function verifySignature(signature: string, timestamp: string, body: any): boolean {
  const publicKey = process.env.SENDGRID_WEBHOOK_PUBLIC_KEY!;
  const payload = timestamp + JSON.stringify(body);

  const verifier = crypto.createVerify('RSA-SHA256');
  verifier.update(payload);

  return verifier.verify(publicKey, signature, 'base64');
}

export default router;
```

**Setup SendGrid Webhook:**
```bash
# 1. –í SendGrid Dashboard:
#    Settings ‚Üí Mail Settings ‚Üí Event Webhook
#    URL: https://yourdomain.com/webhooks/sendgrid
#    Events: delivered, bounce, dropped, spam_report, unsubscribe

# 2. Generate Public Key –¥–ª—è signature verification:
#    Settings ‚Üí Mail Settings ‚Üí Signed Event Webhook Requests

# 3. Add to .env:
SENDGRID_WEBHOOK_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----"
```

**Metrics Dashboard Query:**
```sql
-- Email Delivery Rate (last 7 days)
SELECT
  DATE(timestamp) as date,
  COUNT(*) FILTER (WHERE event = 'delivered') as delivered,
  COUNT(*) FILTER (WHERE event = 'bounce') as bounced,
  COUNT(*) FILTER (WHERE event = 'dropped') as dropped,
  ROUND(100.0 * COUNT(*) FILTER (WHERE event = 'delivered') / COUNT(*), 2) as delivery_rate
FROM email_metrics
WHERE timestamp > NOW() - INTERVAL '7 days'
GROUP BY DATE(timestamp)
ORDER BY date DESC;
```

**Acceptance Criteria:**
- [ ] Webhook endpoint `/webhooks/sendgrid` —Å–æ–∑–¥–∞–Ω
- [ ] Signature verification —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] Events –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ email_metrics
- [ ] Notification status –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (sent/failed)
- [ ] Bounce/spam alerts –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Dashboard query –¥–ª—è delivery rate —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Webhook URL –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ SendGrid

---

### –ó–∞–¥–∞—á–∞ 3.1.4: Event Consumers
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 5 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 3.1.3

#### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏–∑ EventOutbox

**–°–æ–±—ã—Ç–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
1. `reports.report.submitted` ‚Üí –£–≤–µ–¥–æ–º–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
2. `reports.report.reviewed` ‚Üí –£–≤–µ–¥–æ–º–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è
3. `assignments.assignment.created` ‚Üí –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å reminder –∑–∞ 24—á
4. `assignments.assignment.status_changed` ‚Üí –£–≤–µ–¥–æ–º–∏—Ç—å –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã—Ö
5. `assignments.assignment.overdue` ‚Üí –°—Ä–æ—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

#### –®–∞–±–ª–æ–Ω Event Handler

**üìÑ –ü–æ–ª–Ω—ã–π —à–∞–±–ª–æ–Ω:** [`services/notifications/src/consumers/event-consumer.template.ts`](services/notifications/src/consumers/event-consumer.template.ts)

–®–∞–±–ª–æ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- ‚úÖ Polling-based architecture (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
- ‚úÖ Batch processing (–¥–æ 100 —Å–æ–±—ã—Ç–∏–π –∑–∞ —Ä–∞–∑)
- ‚úÖ Retry logic —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
- ‚úÖ Dead Letter Queue –¥–ª—è failed events
- ‚úÖ Graceful shutdown
- ‚úÖ TypeScript —Ç–∏–ø—ã –∏ JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è 5 –±–∞–∑–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π (—Å TODO –¥–ª—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏)

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞

```bash
# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω –≤ –≤–∞—à —Å–µ—Ä–≤–∏—Å
cp services/notifications/src/consumers/event-consumer.template.ts \
   services/notifications/src/consumers/event-consumer.ts

# 2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TODO —Å–µ–∫—Ü–∏–∏ (business logic)

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å consumer
cd services/notifications
pnpm exec tsx src/consumers/event-consumer.ts
```

#### –ö—Ä–∞—Ç–∫–∏–π –ø—Ä–∏–º–µ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```typescript
export class EventConsumer {
  private handlers: Map<string, EventHandler> = new Map();

  async start() {
    while (this.isRunning) {
      const events = await prisma.eventOutbox.findMany({
        where: { status: 'pending' },
        take: 100,
        orderBy: { createdAt: 'asc' }
      });

      for (const event of events) {
        await this.processEventWithRetry(event);
      }

      await sleep(10_000); // 10 seconds
    }
  }

  private async handleReportSubmitted(payload, event) {
    // Create UserNotification
    await prisma.userNotification.create({
      data: {
        userId: payload.specialist_id,
        type: 'report_submitted',
        title: '–ù–æ–≤—ã–π –æ—Ç—á–µ—Ç',
        body: `–†–æ–¥–∏—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –æ—Ç—á–µ—Ç`,
        link: `/dashboard/reports/${payload.report_id}`,
      }
    });

    // Send email if preferences allow
    await emailService.send({ ... });
  }
}
```

#### Acceptance Criteria
- [ ] Consumer –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ background (setInterval –∏–ª–∏ worker thread)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π idempotent (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑)
- [ ] Error handling: failed events ‚Üí EventOutboxFailure
- [ ] Logging –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- [ ] Graceful shutdown

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
services/notifications/src/
‚îú‚îÄ‚îÄ consumers/
‚îÇ   ‚îî‚îÄ‚îÄ event.consumer.ts
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ report-submitted.handler.ts
‚îÇ   ‚îú‚îÄ‚îÄ report-reviewed.handler.ts
‚îÇ   ‚îî‚îÄ‚îÄ assignment-reminder.handler.ts
‚îî‚îÄ‚îÄ workers/
    ‚îî‚îÄ‚îÄ consumer.worker.ts
```

---

### –ó–∞–¥–∞—á–∞ 3.1.5: Cron Jobs –¥–ª—è Reminders
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 3.1.3

#### Scheduled Jobs

**Job 1: Assignment Reminders**
- **Schedule:** –ö–∞–∂–¥—ã–π —á–∞—Å
- **–õ–æ–≥–∏–∫–∞:**
  - –ù–∞–π—Ç–∏ –≤—Å–µ assignments —Å status = 'scheduled'
  - Due date –≤ —Ç–µ—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö 24 —á–∞—Å–æ–≤
  - Reminder –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ Notification —Ç–∞–±–ª–∏—Ü–µ)
  - –°–æ–∑–¥–∞—Ç—å notification + –æ—Ç–ø—Ä–∞–≤–∏—Ç—å email

**Job 2: Overdue Notifications**
- **Schedule:** –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- **–õ–æ–≥–∏–∫–∞:**
  - –ù–∞–π—Ç–∏ –≤—Å–µ assignments —Å status = 'scheduled'
  - Due date < now
  - –û–±–Ω–æ–≤–∏—Ç—å status ‚Üí 'overdue'
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å notification —Ä–æ–¥–∏—Ç–µ–ª—é

**Job 3: Daily Digest –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤**
- **Schedule:** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00
- **–õ–æ–≥–∏–∫–∞:**
  - –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å pending reports
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å digest email —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É
  - "–£ –≤–∞—Å 5 –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ"

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
```typescript
// reminder.job.ts
import cron from 'node-cron';

export class ReminderJob {
  start() {
    // Every hour at :00
    cron.schedule('0 * * * *', async () => {
      await this.sendAssignmentReminders();
    });

    // Every 6 hours
    cron.schedule('0 */6 * * *', async () => {
      await this.processOverdueAssignments();
    });

    // Daily at 9:00 AM
    cron.schedule('0 9 * * *', async () => {
      await this.sendDailyDigest();
    });
  }
}
```

#### Acceptance Criteria
- [ ] Cron jobs –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞
- [ ] Logging –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ job
- [ ] Idempotency: –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- [ ] Error handling: –Ω–µ –ø–∞–¥–∞–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤ –æ–¥–Ω–æ–º job

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
services/notifications/src/
‚îú‚îÄ‚îÄ jobs/
‚îÇ   ‚îú‚îÄ‚îÄ reminder.job.ts
‚îÇ   ‚îú‚îÄ‚îÄ overdue.job.ts
‚îÇ   ‚îî‚îÄ‚îÄ digest.job.ts
‚îî‚îÄ‚îÄ scheduler.ts
```

---

## 3.2 Frontend: Notification Center

### –ó–∞–¥–∞—á–∞ 3.2.1: NotificationBell Component
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 3.1.2

#### UI –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** Header (—Ä—è–¥–æ–º —Å user avatar)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:**
- Bell icon üîî
- Badge —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö (–∫—Ä–∞—Å–Ω—ã–π –∫—Ä—É–∂–æ–∫)
- Click ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç dropdown —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

**Dropdown —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
- –°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- "Mark all as read" button
- "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ" link ‚Üí /dashboard/notifications

#### API Integration

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **User Notifications API** (UI Layer), –∞ –Ω–µ Delivery API.

```typescript
// Fetch unread count and notifications
GET /user-notifications/v1?limit=10&status=unread

// Mark as read
PATCH /user-notifications/v1/:id/read

// Mark all as read
PATCH /user-notifications/v1/read-all
```

**Response Structure:**
```typescript
interface UserNotification {
  id: string;
  userId: string;
  type: 'assignment_reminder' | 'report_reviewed' | 'route_updated';
  title: string;  // "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–¥–∞–Ω–∏–∏"
  body: string;   // "–°–µ–≥–æ–¥–Ω—è –≤ 15:00 - –ü–∞–ª—å—á–∏–∫–æ–≤–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞ –¥–ª—è –ê–ª–∏—Å—ã"
  link: string;   // "/dashboard/assignments/uuid"
  status: 'unread' | 'read' | 'archived';
  readAt: string | null;
  createdAt: string;
}
```

#### Acceptance Criteria
- [ ] Badge –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ unread (max 99+)
- [ ] Dropdown –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –∫–ª–∏–∫—É
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è real-time (polling –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫ –∏–ª–∏ WebSocket)
- [ ] Click –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí PATCH /user-notifications/:id/read + navigate to notification.link
- [ ] Loading state –¥–ª—è —Å–ø–∏—Å–∫–∞
- [ ] Empty state: "–ù–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª—è title, body, link –∏–∑ API response
- [ ] –ò–∫–æ–Ω–∫–∏ –ø–æ —Ç–∏–ø—É: assignment_reminder üìã, report_reviewed ‚úÖ, route_updated üîÑ

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
apps/web/src/components/
‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îî‚îÄ‚îÄ Header.tsx (–∏–∑–º–µ–Ω–∏—Ç—å)
‚îî‚îÄ‚îÄ notifications/
    ‚îú‚îÄ‚îÄ NotificationBell.tsx
    ‚îú‚îÄ‚îÄ NotificationDropdown.tsx
    ‚îî‚îÄ‚îÄ NotificationItem.tsx
```

---

### –ó–∞–¥–∞—á–∞ 3.2.2: Notifications Page
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 3.2.1

#### UI –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/dashboard/notifications`

**–§–∏–ª—å—Ç—Ä—ã:**
- –í—Å–µ / –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
- –ü–æ —Ç–∏–ø—É (assignment, report, system)

**–°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
- Icon –ø–æ —Ç–∏–ø—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- Title + body
- Time ago (e.g., "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥")
- Badge: read/unread
- Click ‚Üí navigate to target (assignment/report)

#### Acceptance Criteria
- [ ] Pagination –∏–ª–∏ infinite scroll
- [ ] –§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Bulk actions: "Mark all as read", "Delete all read"
- [ ] Responsive design

---

### –ó–∞–¥–∞—á–∞ 3.2.3: Notification Preferences Page
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 3.1.2

#### UI –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/dashboard/settings/notifications`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
1. Email notifications (toggle)
   - Assignment reminders
   - Report updates
   - Daily digest
2. In-app notifications (toggle)
3. Quiet hours (time picker: from - to)
4. Frequency (immediate, hourly digest, daily digest)

#### Acceptance Criteria
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Notification preferences
- [ ] Toggle switches —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Quiet hours validation (from < to)
- [ ] Preview: "–í—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å ~X —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –Ω–µ–¥–µ–ª—é"

#### API Endpoint

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Notification Preferences API**.

```typescript
GET   /notification-preferences/v1
PATCH /notification-preferences/v1
```

**Response Example:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "userId": "uuid",
    "emailEnabled": true,
    "inAppEnabled": true,
    "assignmentReminders": true,
    "reportUpdates": true,
    "routeChanges": false,
    "updatedAt": "2025-01-21T10:00:00Z"
  }
}
```

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
apps/web/src/app/dashboard/settings/notifications/
‚îî‚îÄ‚îÄ page.tsx
```

---

## 3.3 Testing & Documentation

### –ó–∞–¥–∞—á–∞ 3.3.1: E2E Tests –¥–ª—è Notifications
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 3.2.2

#### –¢–µ—Å—Ç—ã
```typescript
test.describe('Notifications', () => {
  test('N-1: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ bell', async ({ page }) => {
    // 1. Login
    // 2. Verify bell badge visible
    // 3. Click bell
    // 4. Verify dropdown with notifications
  });

  test('N-2: Mark as read —Ä–∞–±–æ—Ç–∞–µ—Ç', async ({ page }) => {
    // Click notification ‚Üí verify badge count decreases
  });

  test('N-3: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è', async ({ page }) => {
    // Navigate to settings
    // Toggle email notifications
    // Save
    // Reload page
    // Verify settings persisted
  });
});
```

---

## Week 3 Deliverables Checklist

### Backend
- [ ] Notifications Service –Ω–∞ –ø–æ—Ä—Ç—É 4011
- [ ] Notifications API (5 endpoints)
- [ ] Email delivery —Å NodeMailer
- [ ] Email templates (5 types)
- [ ] Event consumers —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Cron jobs –¥–ª—è reminders
- [ ] Preferences API
- [ ] Health check

### Frontend
- [ ] NotificationBell –≤ header
- [ ] Notification dropdown
- [ ] Notifications page (/dashboard/notifications)
- [ ] Notification preferences page
- [ ] E2E —Ç–µ—Å—Ç—ã (3+ —Ç–µ—Å—Ç–æ–≤)

### Infrastructure
- [ ] Notifications service –≤ docker-compose.yml —Å healthcheck
- [ ] SMTP credentials configured
- [ ] Email queue (optional: Redis Bull)

**–ü—Ä–∏–º–µ—Ä docker-compose.yml —Å healthcheck:**
```yaml
services:
  notifications:
    build: ./services/notifications
    ports:
      - "4011:4011"
    environment:
      DATABASE_URL: postgres://neiro_user:neiro_password_dev@postgres:5432/neiro_platform
      SENDGRID_API_KEY: ${SENDGRID_API_KEY}
      SENDGRID_FROM_EMAIL: noreply@neiro.dev
      REDIS_URL: redis://redis:6379  # For email queue (optional)
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4011/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    depends_on:
      postgres:
        condition: service_healthy
```

**Health check endpoint –≤ Notifications Service:**
```typescript
// services/notifications/src/routes/health.ts
app.get('/health', async (req, res) => {
  try {
    await prisma.$queryRaw`SELECT 1`;  // Check DB
    // Optional: check SMTP connection
    const smtpHealthy = await checkSMTPConnection();
    res.status(200).json({
      status: 'healthy',
      smtp: smtpHealthy ? 'connected' : 'disconnected'
    });
  } catch (error) {
    res.status(503).json({ status: 'unhealthy', error: error.message });
  }
});
```

### Email Delivery
- [ ] SendGrid/AWS SES account setup
- [ ] Test emails –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- [ ] Unsubscribe mechanism —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## Week 3 Exit Criteria (Go/No-Go –¥–ª—è Week 4)

### ‚úÖ Must-Have (P0) - –±–ª–æ–∫–µ—Ä—ã Week 4:
- [ ] **Functional:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç email –ø—Ä–∏ –Ω–æ–≤–æ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ (assignment created)
- [ ] **Functional:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç email –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 1 –¥–µ–Ω—å –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞
- [ ] **Functional:** Notification bell –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç unread count –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] **Technical:** Notifications Service healthy –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç emails < 5 –º–∏–Ω—É—Ç —Å –º–æ–º–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏—è
- [ ] **Technical:** Event consumers –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç EventOutbox events –±–µ–∑ –ø–æ—Ç–µ—Ä—å
- [ ] **Tests:** –ú–∏–Ω–∏–º—É–º 3 E2E —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç (bell, notification list, email preferences)

### üìä Success Metrics (–∏–∑–º–µ—Ä–∏–º—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏):
- [ ] **Email Delivery:** >95% emails –¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ (SendGrid webhook confirms)
- [ ] **Latency:** Notifications —Å–æ–∑–¥–∞—é—Ç—Å—è < 1 —Å–µ–∫—É–Ω–¥–∞ –ø–æ—Å–ª–µ —Å–æ–±—ã—Ç–∏—è, –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è < 5 –º–∏–Ω—É—Ç
- [ ] **Test Coverage:** Backend >70%, Frontend >60%
- [ ] **User Experience:** Mark as read —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (<100ms), bell badge –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

### üìã Nice-to-Have (P1) - –Ω–µ –±–ª–æ–∫–µ—Ä—ã:
- [ ] Push notifications (web push)
- [ ] SMS notifications (Twilio)
- [ ] Advanced email templates —Å HTML+CSS
- [ ] Notification grouping/batching (digest mode)

### üö® Red Flags (–ø—Ä–∏—á–∏–Ω—ã –¥–ª—è No-Go –≤ Week 4):
- ‚ùå Email delivery <80% (–±–ª–æ–∫–∏—Ä—É–µ—Ç production)
- ‚ùå Cron jobs –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
- ‚ùå Event consumers —Ç–µ—Ä—è—é—Ç —Å–æ–±—ã—Ç–∏—è –∏–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –¥–≤–∞–∂–¥—ã
- ‚ùå Notification preferences –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

### üîÑ Burn-Down Tracking:
**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ:** 28 —á–∞—Å–æ–≤
**P0 –∑–∞–¥–∞—á–∏:** 22 —á–∞—Å–∞ (79%)
**P1 –∑–∞–¥–∞—á–∏:** 6 —á–∞—Å–æ–≤ (21%)

**Burn-down –ø—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ –∫ —Å–µ—Ä–µ–¥–∏–Ω–µ –Ω–µ–¥–µ–ª–∏ (14—á) –≤—ã–ø–æ–ª–Ω–µ–Ω–æ <50% P0 –∑–∞–¥–∞—á, **–ø–æ–Ω–∏–∑–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç Notification Preferences –¥–æ P2** (–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å UI –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏).

**CRITICAL DECISION POINT:** Notification Preferences (Task 3.2.3, 3.2.4) - —Å–µ–π—á–∞—Å P2. –ï—Å–ª–∏ Week 3 –∏–¥–µ—Ç –ø–æ –ø–ª–∞–Ω—É, –ø–æ–≤—ã—Å–∏—Ç—å –¥–æ P1. –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∏—Å–∫–∏, **–æ—Å—Ç–∞–≤–∏—Ç—å P2 –∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å** (–¥–µ—Ñ–æ–ª—Ç: –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã).

---

# üìÖ WEEK 4: TESTING, POLISH & DOCUMENTATION

**–¶–µ–ª—å:** –î–æ–≤–µ—Å—Ç–∏ –¥–æ production-ready, 100% test coverage, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:** 20 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 (–≤—ã—Å–æ–∫–∏–π)

---

## 4.1 Integration Testing

### –ó–∞–¥–∞—á–∞ 4.1.1: Full E2E Test Suite
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞:** 6 —á–∞—Å–æ–≤

#### –¢–µ—Å—Ç—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

**Reports Flow (complete):**
- [ ] Parent creates report with media
- [ ] Specialist reviews report
- [ ] Status updates reflected in UI

**Progress Dashboard (complete):**
- [ ] Charts render correctly
- [ ] Data filtering works
- [ ] Specialist can compare children

**Notifications (complete):**
- [ ] Email sent on report submission
- [ ] Reminder sent 24h before due date
- [ ] Bell badge updates in real-time

**Full Integration:**
- [ ] End-to-end: Assignment ‚Üí Report ‚Üí Review ‚Üí Progress update
- [ ] Notification triggers work correctly

#### Acceptance Criteria
- [ ] 60+ E2E —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç (–±—ã–ª–æ 53, +7 –Ω–æ–≤—ã—Ö)
- [ ] 100% –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö user flows –ø–æ–∫—Ä—ã—Ç—ã
- [ ] Screenshots –¥–ª—è failing tests
- [ ] Test execution time < 5 –º–∏–Ω—É—Ç

---

### –ó–∞–¥–∞—á–∞ 4.1.2: Load Testing (optional)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞

#### Tools
- **k6** –∏–ª–∏ **Artillery** –¥–ª—è load testing

#### Scenarios
1. 100 concurrent users —Å–æ–∑–¥–∞—é—Ç –æ—Ç—á–µ—Ç—ã
2. 50 concurrent requests –Ω–∞ /analytics/progress
3. 1000 notifications –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

#### Acceptance Criteria
- [ ] API –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 100 RPS –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Latency p95 < 500ms
- [ ] Database connections –Ω–µ –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—Ç—Å—è

---

## 4.2 Technical Debt & Bug Fixes

### –ó–∞–¥–∞—á–∞ 4.2.1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TODO –∏–∑ Month 1-2
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞

#### TODO Items
1. **Email Invitations** (`auth.controller.ts:188`)
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π —á–µ—Ä–µ–∑ Notifications Service
   - Template: `welcome-email.html`

2. **Template Versions** (Templates Service)
   - –î–æ–±–∞–≤–∏—Ç—å endpoint `GET /templates/v1/:id/versions`
   - Frontend –æ–∂–∏–¥–∞–µ—Ç —ç—Ç–æ—Ç endpoint (api.ts:370)

3. **PM-2 Test Fix** (Parent Management)
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å timeout –Ω–∞ –∫–Ω–æ–ø–∫–µ "–û—Ç–º–µ–Ω–∞"
   - –£–ª—É—á—à–∏—Ç—å selector –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É edge case

#### Acceptance Criteria
- [ ] –í—Å–µ TODO —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] Failing tests –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã (PM-2)
- [ ] Code review passed

---

### –ó–∞–¥–∞—á–∞ 4.2.2: Database Optimizations
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞

#### –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

```sql
-- Reports –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
CREATE INDEX idx_reports_assignment_parent ON "Report" ("assignmentId", "parentId");
CREATE INDEX idx_reports_review_status ON "Report" ("reviewStatus", "submittedAt");

-- Notifications –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
CREATE INDEX idx_notifications_user_status ON "Notification" ("userId", "status");
CREATE INDEX idx_notifications_scheduled ON "Notification" ("status", "scheduledAt");
CREATE INDEX idx_notifications_type_date ON "Notification" ("type", "createdAt");

-- Assignments –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è reminders
CREATE INDEX idx_assignments_due_status ON "Assignment" ("status", "dueDate");
```

#### Acceptance Criteria
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ò–Ω–¥–µ–∫—Å—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ prod
- [ ] Query performance —É–ª—É—á—à–∏–ª—Å—è (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å EXPLAIN)

---

## 4.3 Documentation

### –ó–∞–¥–∞—á–∞ 4.3.1: API Documentation
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞

#### Swagger/OpenAPI –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] Reports Service - –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
- [ ] Analytics Service - –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
- [ ] Notifications Service - –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

#### –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- Request/Response schemas
- Authentication requirements
- Error codes
- Rate limiting info

---

### –ó–∞–¥–∞—á–∞ 4.3.2: Architecture Documentation
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞

#### –î–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

**1. ARCHITECTURE.md**
- –î–∏–∞–≥—Ä–∞–º–º–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ (12 —Å–µ—Ä–≤–∏—Å–æ–≤)
- Data flow diagrams
- Event-driven architecture (EventOutbox pattern)
- Database schema overview

**2. DEPLOYMENT.md**
- Docker Compose setup
- Environment variables
- Scaling considerations
- Monitoring setup

**3. DEVELOPMENT.md**
- Local setup guide
- Testing strategy
- Code style guide
- Contributing guidelines

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
```
/docs/
‚îú‚îÄ‚îÄ ARCHITECTURE.md
‚îú‚îÄ‚îÄ DEPLOYMENT.md
‚îú‚îÄ‚îÄ DEVELOPMENT.md
‚îî‚îÄ‚îÄ API_REFERENCE.md
```

---

## 4.4 Final Polish

### –ó–∞–¥–∞—á–∞ 4.4.1: UI/UX Improvements
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞

#### Items
- [ ] Consistent loading states across all pages
- [ ] Error boundaries –¥–ª—è –≤—Å–µ—Ö routes
- [ ] Toast notifications (success/error) —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Form validation messages —É–ª—É—á—à–µ–Ω—ã
- [ ] Mobile responsiveness –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞

---

### –ó–∞–¥–∞—á–∞ 4.4.2: Security Audit
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞

#### Checklist
- [ ] CSRF protection –≤–∫–ª—é—á–µ–Ω–∞
- [ ] Rate limiting –Ω–∞ –≤—Å–µ—Ö endpoints
- [ ] Input validation –Ω–∞ –≤—Å–µ—Ö forms
- [ ] SQL injection –∑–∞—â–∏—Ç–∞ (Prisma)
- [ ] XSS protection (React escape by default)
- [ ] File upload validation (size, type, virus scan)
- [ ] JWT expiration –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Secrets –≤ environment variables (–Ω–µ –≤ –∫–æ–¥–µ)

---

## Week 4 Deliverables Checklist

### Testing
- [ ] 60+ E2E —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç (100%)
- [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (>80% coverage)
- [ ] Load testing completed (optional)
- [ ] All critical bugs fixed

### Technical Debt
- [ ] TODO items —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] Database –∏–Ω–¥–µ–∫—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] Performance optimizations applied

### Documentation
- [ ] API docs (Swagger) –¥–ª—è 3 —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] Architecture documentation
- [ ] Deployment guide
- [ ] Development guide

### Security & Polish
- [ ] Security audit passed
- [ ] UI/UX improvements applied
- [ ] Error handling consistent
- [ ] Mobile responsiveness verified

---

## Week 4 Exit Criteria (GO/NO-GO –¥–ª—è Production)

### ‚úÖ Must-Have (P0) - –±–ª–æ–∫–µ—Ä—ã Production deploy:
- [ ] **Tests:** 60/63 (95%+) E2E —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ (< 5% flaky rate)
- [ ] **Performance:** All services < 200ms (p95), no memory leaks
- [ ] **Security:** Security audit checklist 100% –ø—Ä–æ–π–¥–µ–Ω (CSRF, XSS, SQL injection, file upload validation)
- [ ] **Documentation:** API docs (Swagger) –¥–ª—è Reports, Analytics, Notifications –≥–æ—Ç–æ–≤—ã
- [ ] **Monitoring:** Health checks –¥–ª—è –≤—Å–µ—Ö 11 —Å–µ—Ä–≤–∏—Å–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] **Data Integrity:** Database migrations applied, rollback plan –≥–æ—Ç–æ–≤

### üìä Success Metrics (–∏–∑–º–µ—Ä–∏–º—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏):
- [ ] **Test Coverage:** Backend >80%, Frontend >70%, E2E >95% passing
- [ ] **Zero Critical Bugs:** No P0 bugs in backlog
- [ ] **API Latency:** p50 < 100ms, p95 < 200ms, p99 < 500ms
- [ ] **Service Availability:** All services healthy –¥–ª—è >99% –≤—Ä–µ–º–µ–Ω–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 48 —á–∞—Å–æ–≤

### üìã Nice-to-Have (P1) - –º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å:
- [ ] Load testing >100 concurrent users
- [ ] Deployment automation (CI/CD)
- [ ] Advanced monitoring (Grafana dashboards)
- [ ] Video upload optimization (compression, transcoding)

### üö® Red Flags (–ø—Ä–∏—á–∏–Ω—ã –¥–ª—è NO-GO –≤ Production):
- ‚ùå >10% E2E —Ç–µ—Å—Ç–æ–≤ –ø–∞–¥–∞—é—Ç (flaky –∏–ª–∏ broken)
- ‚ùå Critical security vulnerabilities –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚ùå Memory leaks –∏–ª–∏ p99 latency >2 —Å–µ–∫—É–Ω–¥—ã
- ‚ùå Data loss scenarios –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚ùå No rollback plan –∏–ª–∏ database migration breaks dev environment

### üîÑ Final Burn-Down Tracking:
**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ:** 20 —á–∞—Å–æ–≤
**P0 –∑–∞–¥–∞—á–∏:** 16 —á–∞—Å–æ–≤ (80%) - Testing + Security
**P1 –∑–∞–¥–∞—á–∏:** 4 —á–∞—Å–∞ (20%) - Polish + Documentation

**Decision Point:** –ï—Å–ª–∏ –∫ –∫–æ–Ω—Ü—É Week 4 (Day 5) –æ—Å—Ç–∞—é—Ç—Å—è P0 –∑–∞–¥–∞—á–∏:
1. **Rollback:** –û—Ç–∫–∞—Ç–∏—Ç—å Week 4 changes –∏ deploy Week 1-3 only
2. **Extend:** –î–æ–±–∞–≤–∏—Ç—å Week 4.5 (10 —á–∞—Å–æ–≤) –¥–ª—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏
3. **Ship with Known Issues:** Document remaining bugs, prioritize for Month 4

### üéØ Week 4 Success Definition:
**GO –¥–ª—è Production:** –í—Å–µ 6 Must-Have –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã + 0 Critical bugs + >95% E2E passing + Security audit 100%

**Partial Success:** 4/6 Must-Have –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Üí Deploy to Staging only, defer Production to Month 4

**NO-GO:** <4/6 Must-Have ‚Üí Extend timeline –∏–ª–∏ rollback scope

---

# üéØ MONTH 3 SUCCESS CRITERIA

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### Reports (MUST HAVE)
- [x] –†–æ–¥–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç—á–µ—Ç—ã
- [x] Upload —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ (–¥–æ 5 —Ñ–∞–π–ª–æ–≤)
- [x] –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –æ—Ç—á–µ—Ç—ã
- [x] –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç –æ—Å—Ç–∞–≤–ª—è—Ç—å –æ—Ç–∑—ã–≤—ã
- [x] Media –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –≥–∞–ª–µ—Ä–µ–µ —Å lightbox

### Analytics (MUST HAVE)
- [x] Progress dashboard –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π
- [x] Charts (line, pie, bar) —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] Goals progress –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [x] Specialist overview dashboard
- [x] Comparison –º–µ–∂–¥—É –¥–µ—Ç—å–º–∏

### Notifications (MUST HAVE)
- [x] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è
- [x] Assignment reminders –∑–∞ 24—á
- [x] Report submitted ‚Üí specialist notified
- [x] Report reviewed ‚Üí parent notified
- [x] Notification bell –≤ header
- [x] Preferences –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### Performance
- [ ] API latency p95 < 200ms
- [ ] Page load time < 2 —Å–µ–∫—É–Ω–¥—ã
- [ ] Charts render < 500ms
- [ ] Email delivery < 5 –º–∏–Ω—É—Ç

### Reliability
- [ ] 99.9% uptime –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] Graceful degradation (–µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å —É–ø–∞–ª)
- [ ] Error recovery mechanisms
- [ ] Data consistency (transactions)

### Scalability
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 1000+ users
- [ ] 10000+ assignments –≤ –ë–î
- [ ] 100 RPS –Ω–∞ API
- [ ] Email queue –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

### Security
- [ ] HTTPS enabled
- [ ] JWT secure
- [ ] RBAC enforced
- [ ] File upload validated
- [ ] Rate limiting active

---

## –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏

### Engagement
- [ ] 90%+ –∑–∞–¥–∞–Ω–∏–π –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–æ–≤—Ä–µ–º—è
- [ ] 80%+ –æ—Ç—á–µ—Ç–æ–≤ —Å–æ–¥–µ—Ä–∂–∞—Ç –º–µ–¥–∏–∞
- [ ] –†–æ–¥–∏—Ç–µ–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç progress ‚â•2 —Ä–∞–∑/–Ω–µ–¥–µ–ª—é
- [ ] –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –æ—Ç—á–µ—Ç—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 24—á

### User Satisfaction
- [ ] –†–æ–¥–∏—Ç–µ–ª–∏ –ø–æ–Ω–∏–º–∞—é—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–µ–±–µ–Ω–∫–∞
- [ ] –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã —ç–∫–æ–Ω–æ–º—è—Ç –≤—Ä–µ–º—è –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ spam (unsubscribe rate < 5%)

---

# üìä –†–ò–°–ö–ò –ò –ú–ò–¢–ò–ì–ê–¶–ò–Ø

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| MinIO —Å–ª–æ–∂–Ω–µ–µ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ Exercises service |
| Email –ø–æ–ø–∞–¥–∞–µ—Ç –≤ spam | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SendGrid + –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ headers |
| Event consumers —Ç–æ—Ä–º–æ–∑—è—Ç | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | Async processing, job queue |
| Charts –º–µ–¥–ª–µ–Ω–Ω–æ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | Pagination, data caching |
| –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | Prioritize P0 tasks, defer P2 |

---

# üí∞ –û–¶–ï–ù–ö–ê –¢–†–£–î–û–ó–ê–¢–†–ê–¢

## Summary
**Total: 124 hours** (31 hours/week)

## Breakdown by Week

| Week | Focus | Hours |
|------|-------|-------|
| Week 1 | Reports Service + File Uploads | 40h |
| Week 2 | Analytics + Progress Dashboards | 36h |
| Week 3 | Notifications + Email Delivery | 28h |
| Week 4 | Testing, Polish, Documentation | 20h |

## Breakdown by Role

| Role | Tasks | Hours |
|------|-------|-------|
| Backend Developer | 3 new services, APIs, event consumers | 62h |
| Frontend Developer | Dashboards, forms, charts, components | 42h |
| Full-Stack | Integration, testing, polish | 20h |

---

# üì¶ DELIVERABLES

## Code
1. **3 New Microservices**
   - Reports Service (port 4009)
   - Analytics Service (port 4010)
   - Notifications Service (port 4011)

2. **Frontend Pages**
   - Report submission form
   - Report review dashboard
   - Progress dashboard (parent)
   - Analytics dashboard (specialist)
   - Notifications page
   - Notification preferences

3. **Components**
   - 20+ new React components
   - Charts library integration
   - Media upload component
   - Notification bell

## Infrastructure
4. **Docker Compose**
   - 3 new services added
   - Environment variables configured

5. **Database**
   - Indexes for optimization
   - No new tables (all exist!)

## Documentation
6. **API Documentation**
   - Swagger for 3 services
   - 30+ endpoints documented

7. **Architecture Docs**
   - ARCHITECTURE.md
   - DEPLOYMENT.md
   - DEVELOPMENT.md

## Testing
8. **E2E Tests**
   - 60+ tests (from 53)
   - 100% critical flows covered

9. **Load Tests**
   - Performance benchmarks
   - Scalability validation

---

# üöÄ NEXT STEPS AFTER MONTH 3

## Month 4 Candidates (Prioritized)

### 1. Communications Service (Chat) - P1
- Real-time messaging (Socket.io)
- Chat –º–µ–∂–¥—É —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏
- File sharing –≤ —á–∞—Ç–µ
- Message history
- Typing indicators

### 2. Advanced Analytics - P2
- AI-powered insights
- Predictive analytics (—Ä–∏—Å–∫ –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏—è)
- Recommendations engine
- Comparative analytics (—Ä–µ–±–µ–Ω–æ–∫ vs. cohort)

### 3. Mobile App - P1
- React Native –∏–ª–∏ Progressive Web App (PWA)
- Push notifications (FCM)
- Offline mode
- Native camera integration

### 4. Reporting & Export - P2
- PDF reports –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- Excel export
- Custom report builder
- Scheduled reports (weekly/monthly)

### 5. Billing & Subscriptions - P2
- Stripe integration
- Subscription plans
- Payment history
- Invoicing

---

# üìä TESTING & BURN-DOWN STRATEGY

## E2E Testing Plan

### Current State (Month 1-2)
- **Total Tests:** 53 E2E tests
- **Passing:** 50/53 (94.3%)
- **Known Issues:** 2 intermittent failures (CJM #2.2, PM-2), 1 missing feature (progress page)

### Month 3 Target
- **Total Tests:** 63+ E2E tests (53 existing + 10+ new)
- **Passing Rate:** >95% (60/63)
- **Flaky Rate:** <5% (max 3 flaky tests)

### New Test Coverage (by week)

**Week 1 - Reports (4+ tests):**
```typescript
// apps/web/e2e/reports.spec.ts
- R-1: Parent can create report for completed assignment
- R-2: Parent can upload photo (1-5 files)
- R-3: Specialist can view reports list
- R-4: Specialist can review report (approve/reject)
- R-5: Media gallery displays uploaded photos
```

**Week 2 - Analytics (3+ tests):**
```typescript
// apps/web/e2e/analytics.spec.ts
- A-1: Parent views child progress dashboard
- A-2: Charts render correctly (line, pie, bar)
- A-3: Specialist views overview dashboard
```

**Week 3 - Notifications (3+ tests):**
```typescript
// apps/web/e2e/notifications.spec.ts
- N-1: Notification bell shows unread count
- N-2: Notification dropdown displays recent notifications
- N-3: Mark as read works correctly
```

### Test Execution Strategy

**Daily Runs:**
- Run full E2E suite each morning (before standup)
- Report failures in team chat
- Fix flaky tests within 24 hours

**Pre-Merge Runs:**
- Run affected tests before merging PR
- Require >95% passing rate to merge

**Parallel Execution:**
```bash
# Current: 1 worker (sequential)
npx playwright test --workers=1

# Optimize for Week 4: 4 workers (parallel)
npx playwright test --workers=4 --retries=2
```

**Expected Duration:**
- Current (53 tests, 1 worker): ~10 minutes
- Target (63 tests, 4 workers): ~5 minutes
- Acceptable: <15 minutes total

---

## Burn-Down Tracking (Weekly)

### Overall Month 3 Budget
- **Total Estimated:** 132 hours (8 pre-work + 124 dev)
- **P0 Tasks:** 100 hours (76%)
- **P1 Tasks:** 24 hours (18%)
- **P2 Tasks:** 8 hours (6%)

### Burn-Down Rules

#### Rule 1: Mid-Week Check (Day 3 of each week)
**If completed < 40% of week's P0 tasks:**
1. Drop all P2 tasks immediately
2. Re-prioritize P1 tasks (keep only must-haves)
3. Escalate to team lead/PM
4. Consider scope reduction

#### Rule 2: End-of-Week Check (Day 5)
**If completed < 75% of week's P0 tasks:**
1. Rollback partially completed features
2. Document remaining work as tech debt
3. Do NOT carry over to next week (clean slate)
4. Adjust scope for upcoming week

#### Rule 3: Weekly Retrospective
After each week, update this document:
- Actual hours vs estimated
- Reasons for deviation
- Adjust estimates for remaining weeks

### Weekly Burn-Down Targets

```
Week 0: 8 hours (100% infrastructure setup)
‚îú‚îÄ Day 1-2: MinIO + Redis (4h)
‚îú‚îÄ Day 3: SendGrid + SMTP (2h)
‚îî‚îÄ Day 4-5: .env + Schema Preview (2h)

Week 1: 40 hours (80% P0, 20% P1)
‚îú‚îÄ Day 1-2: Service Setup + CRUD API (16h) ‚úì Must complete
‚îú‚îÄ Day 3: Media Upload (8h) ‚úì Must complete
‚îú‚îÄ Day 4: Frontend Components (8h) ‚úì Must complete
‚îî‚îÄ Day 5: Testing + Integration (8h) ‚úì Must complete
Target: 32h P0 done by EOD Day 4

Week 2: 36 hours (83% P0, 17% P1)
‚îú‚îÄ Day 1-2: Analytics Service + APIs (14h) ‚úì Must complete
‚îú‚îÄ Day 3: Redis Caching (6h) ‚úì Must complete
‚îú‚îÄ Day 4: Frontend Charts (8h) ‚úì Must complete
‚îî‚îÄ Day 5: Testing + Polish (8h) ‚úì Must complete
Target: 28h P0 done by EOD Day 4

Week 3: 28 hours (79% P0, 21% P1)
‚îú‚îÄ Day 1-2: Notifications Service + API (10h) ‚úì Must complete
‚îú‚îÄ Day 3: Email Delivery (6h) ‚úì Must complete
‚îú‚îÄ Day 4: Frontend Bell + Dropdown (6h) ‚úì Must complete
‚îî‚îÄ Day 5: Testing + Cron Jobs (6h) ‚úì Must complete
Target: 22h P0 done by EOD Day 4

Week 4: 20 hours (80% P0, 20% P1)
‚îú‚îÄ Day 1-2: E2E Tests + Bug Fixes (10h) ‚úì Must complete
‚îú‚îÄ Day 3: Security Audit (4h) ‚úì Must complete
‚îî‚îÄ Day 4-5: Documentation + Polish (6h) Optional
Target: 14h P0 done by EOD Day 3
```

---

## Risk Mitigation

### High-Risk Areas

**1. File Upload (Week 1)**
- **Risk:** MinIO integration –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è
- **Mitigation:** Test MinIO setup –≤ Week 0, fallback to local storage
- **Contingency:** Use base64 inline storage (temporary)

**2. Email Delivery (Week 3)**
- **Risk:** SendGrid account –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å –≥–æ—Ç–æ–≤ –∏–ª–∏ blocked
- **Mitigation:** Setup SMTP fallback (Nodemailer + Gmail) –≤ Week 0
- **Contingency:** Log emails to console, deploy notifications –±–µ–∑ email

**3. E2E Test Stability (Week 4)**
- **Risk:** Flaky tests –º–æ–≥—É—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å 10%
- **Mitigation:** Fix isolation issues (CJM #2.2) –≤ Week 1-2
- **Contingency:** Document known flaky tests, manual testing for critical paths

**4. Performance Issues (Week 2)**
- **Risk:** Analytics API –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º (>500ms)
- **Mitigation:** Redis caching —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞, optimize queries
- **Contingency:** Reduce data granularity (daily instead of hourly)

### Scope Reduction Scenarios

**Scenario A: Week 1 Behind Schedule (>20% delay)**
- Drop video upload support (only photos)
- Drop thumbnail generation (show original images)
- Defer report reviews to Week 2

**Scenario B: Week 2 Behind Schedule**
- Simplify charts (—Ç–æ–ª—å–∫–æ line chart, no pie/bar)
- Remove specialist dashboard (focus on parent view only)
- Use mock data instead of real-time aggregation

**Scenario C: Week 3 Behind Schedule**
- Remove notification preferences UI (use defaults)
- Simplify email templates (plain text only)
- Defer cron jobs (manual trigger via API)

---

## Quality Gates (GO/NO-GO Checkpoints)

### Daily Quality Gate (Every EOD)
- [ ] All services healthy (`docker-compose ps`)
- [ ] No broken builds (`npm run build` succeeds)
- [ ] New code committed and pushed

### Weekly Quality Gate (Every Friday EOD)
- [ ] Week Exit Criteria met (see Week 1-4 sections above)
- [ ] No regression in existing tests
- [ ] Code reviewed (if team >1 developer)
- [ ] Demo prepared for stakeholder (optional)

### Final Quality Gate (End of Month 3)
- [ ] 60/63 (95%+) E2E tests passing
- [ ] All 11 services healthy
- [ ] Security audit 100% passed
- [ ] API docs complete
- [ ] Zero P0 bugs in backlog

**GO Decision:** If all 5 final gates passed ‚Üí Production deploy approved

**NO-GO Decision:** If <3/5 gates passed ‚Üí Defer to Month 4, deploy to Staging only

---

## Decisions Log

**Date: 2025-01-21**
- –í—ã–±—Ä–∞–ª–∏ Recharts –¥–ª—è charts (—É–∂–µ –≤ dependencies)
- SendGrid –¥–ª—è email delivery (vs AWS SES)
- Event-driven notifications –≤–º–µ—Å—Ç–æ direct calls
- Redis caching –¥–ª—è analytics (TTL = 5 –º–∏–Ω—É—Ç)

## Assumptions
- SendGrid free tier –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è dev/test
- MinIO —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Exercises service
- Existing EventOutbox pattern —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Database indexes –Ω–µ —Ç—Ä–µ–±—É—é—Ç downtime

## Open Questions
- [ ] –ù—É–∂–µ–Ω –ª–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å –¥–ª—è file uploads? (ClamAV?)
- [ ] WebSocket –¥–ª—è real-time notifications –∏–ª–∏ polling?
- [ ] Separate Redis instance –¥–ª—è job queue?
- [ ] Multi-language support (i18n) in scope?

---

**END OF DOCUMENT**

_Created: 2025-01-21_
_Last Updated: 2025-01-21_
_Version: 2.2_
_Status: Planning_

## Changelog

**v2.4 (2025-01-22) - Notifications Split Architecture:**
- ‚úÖ **–ê–†–•–ò–¢–ï–ö–¢–£–†–ê NOTIFICATIONS**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–≤—É—Ö—Å–ª–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ NOTIFICATIONS_SPLIT_PROPOSAL.md
- ‚úÖ Task 0.5.1: –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ `UserNotification` (UI layer) –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ `Notification` (delivery layer)
- ‚úÖ Task 0.5.1: –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `NotificationPreference` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (reportUpdates, routeChanges)
- ‚úÖ Section 3.1.2: Notifications API —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ Delivery API (internal) –∏ User Notifications API (public)
- ‚úÖ Section 3.1.2: –î–æ–±–∞–≤–ª–µ–Ω—ã endpoints `/user-notifications/v1` –∏ `/notification-preferences/v1`
- ‚úÖ Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã: NotificationBell –∏—Å–ø–æ–ª—å–∑—É–µ—Ç User Notifications API
- ‚úÖ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: childMood mapping –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (3 –∑–Ω–∞—á–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ 5: good/neutral/difficult)
- ‚úÖ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: –£–¥–∞–ª–µ–Ω—ã –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è (engagement, difficulties)
- ‚úÖ Infrastructure: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã healthcheck –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Reports, Analytics, Notifications)
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç Critical Compliance Issue #6 –∏–∑ MONTH_3_COMPLIANCE_REPORT.md

**v2.2 (2025-01-21):**
- ‚úÖ **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –°–•–ï–ú–´ –ë–î**: Task 0.5.1 –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è schema.prisma
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏: Report (—Å JSON media), Notification (—Å JSON payload), MediaAsset (–ø–æ–ª–∏–º–æ—Ä—Ñ–Ω–∞—è —Å–≤—è–∑—å)
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –º–æ–¥–µ–ª—å ReportMedia - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è MediaAsset —Å ownerType/ownerId
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Report: media —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ JSON array, –Ω–µ FK relation
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Notification: –¥–∞–Ω–Ω—ã–µ –≤ payload JSON, –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è userId/type/subject/body
- ‚úÖ –£—Ç–æ—á–Ω–µ–Ω–æ: —Ç–æ–ª—å–∫–æ NotificationPreference —Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ –£–ñ–ï —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è JSON –ø–æ–ª–µ–π –∏ MediaAsset pattern
- ‚úÖ –ü–ª–∞–Ω —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—É—â–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

**v2.1 (2025-01-21):**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä–æ–ª—å MinIO: `minioadmin` ‚Üí `minioadmin123` (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ docker-compose.yml)
- ‚úÖ –£—Ç–æ—á–Ω–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º (6379) –∏ –≤–Ω–µ—à–Ω–µ–º (6380) –ø–æ—Ä—Ç–∞—Ö
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Redis –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ vs —Å —Ö–æ—Å—Ç–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É —Å—Ç–µ–∫—É (Node.js 20, TypeScript 5.3.3, PostgreSQL 15)

**v2.0 (2025-01-21):**
- ‚úÖ Added Week 0 (Infrastructure Pre-work) - 8 hours
- ‚úÖ Added Exit Criteria –¥–ª—è Week 1-4 —Å –∏–∑–º–µ—Ä–∏–º—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- ‚úÖ Added Burn-Down Tracking —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ weekly targets
- ‚úÖ Added E2E Testing Plan (53 ‚Üí 63 tests, 94.3% ‚Üí 95%+ passing)
- ‚úÖ Added Risk Mitigation Strategy —Å contingency plans
- ‚úÖ Added Quality Gates (Daily, Weekly, Final)
- ‚úÖ Clarified Notification Preferences priority (P2 with decision point)
- ‚úÖ Total timeline: 132 hours (8h pre-work + 124h dev)

**v2.3 (2025-01-21) - Compliance Update:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å API_CONTRACTS_MVP.md v0.8
- ‚úÖ POST /reports/v1: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è (durationMinutes, status, feedbackText, childMood values)
- ‚úÖ POST /reports/v1/:id/review: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è (notes –≤–º–µ—Å—Ç–æ specialistNotes)
- ‚úÖ Media Upload: 3-step flow —Å presigned URLs –∏ confirm endpoint
- ‚úÖ Event names —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏: `reports.report.submitted`, `reports.report.reviewed`, `reports.media.attached`
- ‚úÖ –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω MONTH_3_COMPLIANCE_REPORT.md

**v2.2 (2025-01-21) - Schema Compliance:**
- ‚úÖ MinIO credentials –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ Report.media JSONB —Ñ–æ—Ä–º–∞—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Polymorphic MediaAsset pattern –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω

**v1.0 (2025-01-21):**
- Initial plan creation
- Week 1-4 tasks breakdown
- API specifications
- File structures
